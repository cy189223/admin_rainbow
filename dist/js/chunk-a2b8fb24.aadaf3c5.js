(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a2b8fb24"],{"016f":function(t,e,i){"use strict";i("8de4")},"09b3":function(t,e,i){},2163:function(t,e,i){"use strict";i("7a40")},"2d8b":function(t,e,i){"use strict";i("a39b")},"7a40":function(t,e,i){},"8de4":function(t,e,i){},"8fe7":function(t,e,i){},"9ddb":function(t,e,i){"use strict";i("a209")},"9f14":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"list"},[e("div",{staticClass:"content-head",staticStyle:{"margin-bottom":"20px"}},[e("div",{staticClass:"sort-keys"},[e("div",{staticClass:"tab-list"},t._l(t.statusList,(function(i,n){return e("div",{staticClass:"item",class:{actived:t.status===i.key},on:{click:function(e){t.status=i.key}}},[t._v("\n           "+t._s(i.text)+"\n           ("+t._s(t.statusTotal[i.key])+")\n         ")])})),0),e("a-input-search",{staticStyle:{width:"180px","margin-right":"10px"},attrs:{placeholder:"输入关键字","enter-button":"",allowClear:"",size:t.size},on:{input:t.onSearch,search:t.onSearch},model:{value:t.key,callback:function(e){t.key=e},expression:"key"}}),e("router-link",{staticStyle:{margin:"0px 10px"},attrs:{to:"/activity/yifanshang/setting"}},[t._v("规则配置")])],1),t.selectMode?t._e():e("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:t.handleCreate}},[t._v("创建"+t._s(t.resourceTypeText))])],1),e("a-table",{staticClass:"table",attrs:{rowKey:function(t){return t.uuid},dataSource:t.list,pagination:t.pagination,size:t.size}},[e("a-table-column",{attrs:{title:"标题",width:"240px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("div",{staticClass:"title-c"},[e("img",{staticClass:"thumb",attrs:{src:i.thumb}}),e("div",{staticClass:"right"},[e("div",{staticClass:"title"},[t._v(t._s(i.title))]),e("PriceDisplay",{attrs:{info:i}})],1)])]}}])}),e("a-table-column",{attrs:{title:"分类",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("div",[t._v(t._s("yfs"==i.type?"一番赏":"双随机"))])]}}])}),e("a-table-column",{attrs:{title:"箱子数",width:"100px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleEditRoom(i)}}},[e("span",[t._v("共"+t._s(i.room_total)+"箱子")])])]}}])}),e("a-table-column",{attrs:{title:"已抽次数",width:"100px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleShowPackageSku(i)}}},[e("span",[t._v("已抽"+t._s(i.open_total)+"次")])])]}}])}),e("a-table-column",{attrs:{width:"160px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("div",[e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleEditNormalSku(i)}}},[t._v("\n            "+t._s(i.normal_sku_total)+" 种购买赏\n          ")]),t._v("\n          "+t._s(i.normal_sku_stock)+"库存\n        ")]),i.gift_sku_total>0?e("div",{staticStyle:{"margin-top":"6px"}},[e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleEditGiftSku(i)}}},[t._v("\n            "+t._s(i.gift_sku_total)+" 种赠送赏\n          ")]),t._v("\n          "+t._s(i.gift_sku_stock)+"库存\n        ")]):t._e()]}}])},[e("div",{attrs:{slot:"title"},slot:"title"},[t._v("\n        奖品池\n        "),e("tips",[t._v("1、购买赏由用户支付后抽出"),e("br"),t._v("2、赠送赏仅可以由系统抽奖送出")])],1)]),t.selectMode?t._e():e("a-table-column",{attrs:{title:"排序",width:"100px"},scopedSlots:t._u([{key:"default",fn:function(i){return[t._v("\n        "+t._s(i.list_weight)+"\n        "),e("span",{staticStyle:{"margin-left":"10px"},on:{click:function(e){return t.handleEditListWeight(i)}}},[e("a",{attrs:{href:"javascript:;"}},[e("a-icon",{attrs:{type:"edit"}})],1)])]}}],null,!1,3403708818)}),t.selectMode?t._e():e("a-table-column",{attrs:{title:"是否上架",width:"60px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("ISwitch",{attrs:{value:i.status,active:1,unactive:0},on:{change:function(e){return t.listedStatusChange(e,i)}}})]}}],null,!1,1077108743)}),e("a-table-column",{attrs:{title:"创建日期",width:"100px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[t._v(t._s(t.$tool.showShortTime(i.created_at)))])]}}])}),t.selectMode?t._e():e("a-table-column",{attrs:{title:"操作",width:"180px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.getPath(i)}}},[t._v("预览/路径")]),e("a-divider",{attrs:{type:"vertical"}}),e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleEdit(i)}}},[t._v("编辑")]),e("a-divider",{attrs:{type:"vertical"}}),e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleCopy(i)}}},[t._v("复制")]),e("a-divider",{attrs:{type:"vertical"}}),e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleDelete(i)}}},[t._v("删除")])],1)]}}],null,!1,784634761)})],1),e("a-modal",{staticStyle:{top:"100px"},attrs:{maskClosable:!1,title:(t.editUuid?"编辑":"创建")+t.resourceTypeText,visible:t.isEdit,width:"1000px",footer:null},on:{cancel:function(e){t.isEdit=!1}}},[t.isEdit?e("Edit",{attrs:{uuid:t.editUuid},on:{cancel:function(e){t.isEdit=!1},success:t.fetchData}}):t._e()],1),t.isEditNormalSku?e("EditNormalSku",{attrs:{info:t.current},on:{refresh:t.fetchData,close:function(e){t.isEditNormalSku=!1}}}):t._e(),t.isEditGiftSku?e("EditGiftSku",{attrs:{info:t.current},on:{refresh:t.fetchData,close:function(e){t.isEditGiftSku=!1}}}):t._e(),t.isEditRoom?e("EditRoom",{attrs:{info:t.current},on:{editOdds:t.handleEditOdds,refresh:t.fetchData,close:function(e){t.isEditRoom=!1}}}):t._e(),t.isEditPackageSku?e("EditPackageSku",{attrs:{info:t.current},on:{refresh:t.fetchData,close:function(e){t.isEditPackageSku=!1}}}):t._e(),t.isEditOdds?e("EditOdds",{attrs:{info:t.currentRoom},on:{refresh:t.fetchData,close:function(e){t.isEditOdds=!1}}}):t._e()],1)},a=[],s=(i("8e6e"),i("ac6a"),i("456d"),i("ade3")),o=(i("c1df"),i("7cc6")),r=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[e("a-tabs",{attrs:{"default-active-key":"1"}},[e("a-tab-pane",{key:"1",attrs:{tab:"基础设置"}},[e("IForm",{staticClass:"form-container",attrs:{formFrame:t.frameBase,formData:t.form},on:{"update:formData":function(e){t.form=e},"update:form-data":function(e){t.form=e}}})],1),e("a-tab-pane",{key:"2",attrs:{tab:"规则设置","force-render":""}},[e("IForm",{staticClass:"form-container",attrs:{formFrame:t.frameUI,formData:t.form},on:{"update:formData":function(e){t.form=e},"update:form-data":function(e){t.form=e}}})],1)],1),e("div",{staticStyle:{display:"flex","justify-content":"flex-end"},attrs:{slot:"action"},slot:"action"},[e("a-button",{staticClass:"btn",on:{click:t.cancel}},[t._v("取消")]),e("a-button",{staticClass:"btn",attrs:{type:"primary"},on:{click:t.submit}},[t._v("提交")])],1)],1)},l=[],u=i("b0a5");function c(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function d(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?c(Object(i),!0).forEach((function(e){Object(s["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):c(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var p="yi-fan-shangs",f={components:{IForm:u["a"]},data:function(){return{form:{},categoryList:[]}},props:{uuid:{type:String}},computed:{categoryOptions:function(){return this.categoryList.map((function(t){return{title:t.title,value:t.id}}))},frameBase:function(){return[{title:"活动标题",key:"title",newline:!0,required:!0},{title:"副标题",key:"sub_title",placeholder:"例如: 直播中随机抽取10位幸运儿",newline:!0},{title:"分类",key:"type",type:"radio",default:"yfs",required:!0,options:[{title:"一番赏",value:"yfs"},{title:"双随机",value:"ssj"}],tips:' <span style="color:red;">创建后不可更改</span>',disabled:this.uuid,newline:!0},{title:"标签",key:"tags",type:"tags",placeholder:"",tips:"选填， 显示在列表标题下方",newline:!0,required:!0},{title:"封面",key:"thumb",type:"image",tips:"800*800",sizeLimit:200,isShowImageTips:!1,newline:!0,required:!0},{title:"售价",key_prefix:"",type:"mix_price",newline:!0,required:!0},{title:"赏品设置",type:"text",text:"创建后在列表中设置赏品"},{type:"blank",newline:!0},{title:"详情图",key:"detail_images",type:"images",isShowImageTips:!1,tips:"1000px宽度，高度不限，长图请切成多张小图上传",newline:!0}]},frameUI:function(){return[{title:"箱子(房间)数量",type:"number",key:"room_total",tips:'<span style="color:red;">创建后不可更改</span>',required:!0,disabled:this.uuid},{title:"购买赏种类",type:"number",key:"normal_sku_total",tips:'默认ABCDEF共6个赏 <span style="color:red;">创建后不可更改</span> 购买赏即用户可通过购买获取的赏品',required:!0,default:6,disabled:this.uuid},{title:"赠送赏种类",type:"number",key:"gift_sku_total",tips:'默认First、Last赏共2个赏 <span style="color:red;">创建后不可更改</span> 赠送赏不可通过购买获得，赠送赏只能在指定参与用户段中自动抽取送出',required:!0,default:2,span:24,disabled:this.uuid,where:{type:"ssj"}},{title:"赠送赏",key:"gift_sku_total1",type:"radio",default:1,required:!0,options:[{title:"不赠送",value:0},{title:"赠送1种赏",value:1}],tips:' <span style="color:red;">创建后不可更改</span>',disabled:this.uuid,newline:!0,where:{type:"yfs"}},{type:"blank"},{title:"随机免单",type:"number",input_width:"160px",key:"free_order_total",placeholder:"0为无免单",prefix:"每一箱中随机",suffix:"发免单"},{type:"blank"},{title:"全包设置",type:"number",input_width:"160px",key:"last_stock_all_pick_enable",placeholder:"0为不限制",tips:"0为不限制",prefix:"最后剩",suffix:"发时才可全包"},{title:"上半场设置",type:"number",input_width:"160px",key:"half_buy_before_all_pick",placeholder:"0为不限制",tips:"0为不限制",prefix:"上半场抽过",suffix:"发的用户才允许参与全包"},{title:"全场设置",type:"number",input_width:"160px",key:"buy_before_all_pick",placeholder:"0为不限制",tips:"0为不限制",prefix:"全场抽过",suffix:"发的用户才允许参与全包"},{type:"blank",newline:!0},{title:"用户参与次数限制",key:"per_user_limit",prefix:"每个用户本活动中总共可抽",type:"number",suffix:"次",tips:"0为不限制"},{title:"限制每次单发抽",key:"is_limit_1",type:"boolean",default:0,tips:"开启后每次只能单发抽，其它连抽将禁用"},{title:"必须绑定手机",key:"is_need_phone",type:"boolean",default:0,tips:"开启后会强制用户先绑定手机号"},{type:"blank",newline:!0}]}},created:function(){},mounted:function(){this.uuid=this.uuid||this.$route.params.uuid,this.initForm()},watch:{uuid:function(){this.initForm()}},methods:{initForm:function(){var t=this;this.uuid?this.$http("/".concat(p,"/").concat(this.uuid)).then((function(e){t.form=e.data.info})):this.form=d({},this.$initForm(this.frameBase)),console.log(this.form)},cancel:function(){this.uuid="",this.$emit("cancel")},create:function(){var t=this;if(console.log(this.form),"ssj"==this.form.type){if(this.form.gift_sku_total<2)return void this.$message.warning("赠送商品最少为2个");delete this.form.gift_sku_total1}else this.$set(this.form,"gift_sku_total",this.form.gift_sku_total1),delete this.form.gift_sku_total1;this.$http.post("/".concat(p),d({type:this.type},this.form)).then((function(e){t.$message.success("创建成功"),t.$emit("success")}))},update:function(){var t=this;this.$http.patch("/".concat(p,"/").concat(this.uuid),{type:"update",attributes:this.form}).then((function(e){t.$message.success("更新成功"),t.$emit("success")}))},submit:function(){this.uuid?this.update():this.create()}}},h=f,y=(i("e437"),i("2877")),_=Object(y["a"])(h,r,l,!1,null,"3e98428f",null),m=_.exports,b=function(){var t=this,e=t._self._c;return e("a-modal",{staticStyle:{top:"100px"},attrs:{title:"编辑普通赏",visible:!0,width:"1200px"},on:{cancel:t.handleCancel}},[e("div",{staticClass:"tips"}),e("a-table",{staticClass:"product-table",attrs:{rowKey:function(t){return t.id},dataSource:t.list,bordered:"",pagination:!1,size:"small"}},[e("a-table-column",{attrs:{title:"序号",width:"20px"},scopedSlots:t._u([{key:"default",fn:function(i,n,a){return[e("div",[t._v(t._s(a+1))])]}}])}),e("a-table-column",{key:"thumb",attrs:{title:"图片",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("div",{staticStyle:{display:"flex","align-items":"center"}},[e("img",{staticClass:"thumb",staticStyle:{"margin-right":"10px"},attrs:{src:i.thumb}}),e("div",[t._v("\n            "+t._s(i.title)+" "),e("br"),t._v("\n            "+t._s(i.number)+"\n          ")])])]}}])}),e("a-table-column",{key:"number",attrs:{title:"赏标题",width:"50px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("div",[t._v("\n          "+t._s(i.shang_title||"-")+"\n          ")])]}}])}),e("a-table-column",{key:"number",attrs:{title:"回收价",width:"100px"},scopedSlots:t._u([{key:"default",fn:function(t){return[e("div",[e("PriceDisplay",{attrs:{info:t}})],1)]}}])}),e("a-table-column",{key:"number",attrs:{title:"显示零售价",width:"100px"},scopedSlots:t._u([{key:"default",fn:function(i){return[i.display_money_price?e("div",[t._v("\n          "+t._s(i.display_money_price/100)+" 元\n          ")]):t._e()]}}])}),e("a-table-column",{attrs:{title:"SKU类型",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[1===i.sku_type?e("span",[t._v("-")]):2===i.sku_type?e("span",[t._v("绑定商品")]):3===i.sku_type?e("span",[t._v("绑定虚拟资产")]):t._e()])]}}])}),e("a-table-column",{attrs:{width:"80px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[i.presell_date?e("span",[t._v(t._s(i.presell_date))]):e("span",[t._v("-")])])]}}])},[e("div",{attrs:{slot:"title"},slot:"title"},[t._v("\n        预售时间\n        "),e("tips",[t._v("设置后在预售时间前用户无法选择发货")])],1)]),t.selectMode?t._e():e("a-table-column",{attrs:{title:"排序",width:"60px"},scopedSlots:t._u([{key:"default",fn:function(i){return[t._v("\n        "+t._s(i.list_weight)+"\n        "),e("span",{staticStyle:{"margin-left":"10px"},on:{click:function(e){return t.handleEditListWeight(i)}}},[e("a",{attrs:{href:"javascript:;"}},[e("a-icon",{attrs:{type:"edit"}})],1)])]}}],null,!1,3403708818)}),e("a-table-column",{attrs:{title:"总库存",width:"60px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[t._v("\n          "+t._s(i.stock)+"件\n          ")])]}}])}),e("a-table-column",{attrs:{title:"每箱数量",width:"60px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[t._v("\n          "+t._s(i.total_per_room)+"件\n          ")])]}}])}),e("a-table-column",{attrs:{title:"操作",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleEdit(i)}}},[t._v("编辑")])]}}])})],1),e("template",{slot:"footer"},[e("div",{staticClass:"btn-c"},[e("div",{staticStyle:{"flex-grow":"1"}}),e("a-button",{key:"back",on:{click:t.handleCancel}},[t._v("关闭")])],1)])],2)},k=[],g=i("7971");function v(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function w(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?v(Object(i),!0).forEach((function(e){Object(s["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):v(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var S={components:{UploadImages:g["a"],iSwitch:o["a"]},props:{info:{type:Object,default:function(){return{}}}},data:function(){return{list:[],frame:[{title:"SKU类型",key:"sku_type",type:"radio",default:1,required:!0,options:[{title:"无绑定",value:1},{title:"绑定商城中的商品",value:2},{title:"平台虚拟资产",value:3}],tips:""},{title:"绑定商品",key:"product_id",type:"product_id",where:{sku_type:2}},{title:"绑定虚拟资产",key:"assets",type:"assets",where:{sku_type:3}},{title:"奖品名称",key:"title",required:!0,placeholder:'如"积分礼包1"'},{title:"编号",key:"number",placeholder:"填写编号方便在订单中对应货物"},{title:"赏标题",key:"shang_title",placeholder:"例如 A赏 B赏"},{title:"封面",key:"thumb",type:"image",tips:"建议宽600，高900"},{title:"必不出",key:"disabled_before_index",type:"number",prefix:"每个房间前",suffix:"发必不出此奖品",tips:"0为不限制",newline:!0},{type:"blank"},{title:"回收价",key_prefix:"",type:"mix_price",tips:"价值用于回收时作为回收原价进行折扣计算",newline:!0,required:!0},{title:"显示零售价",key:"display_money_price",type:"price",tips:"零售价仅用于小程序显示， 选填",newline:!0},{title:"每个箱子数量",key:"total_per_room",type:"number",tips:"每个箱子内提供的奖品数量",required:!0},{title:"预售日期",key:"presell_date",showTime:!1,type:"date",tips:"设置此日期后，用户仓库内此奖品只能在预售日期之后才能进行发货"},{title:"奖品详情图",key:"detail_images",type:"images",newline:!0,sizeLimit:400,tips:"显示在用户的物品详情中。 不上传则不显示。 <br/> 长图请切成多张小图上传"}]}},watch:{uuid:function(){this.initList()}},created:function(){this.initList()},methods:{initList:function(){var t=this;this.$http.get("/yi-fan-shang/skus",{params:{shang_type:"normal",activity_id:this.info.id}}).then((function(e){t.list=e.data.list}))},handleCreate:function(){var t=this;this.$iForm.show({title:"新增活动奖品",frame:this.frame,success:function(e){t.$http.post("/yi-fan-shang/skus",w({},e)).then((function(e){t.initList(),t.$iForm.hide()}))}})},handleEdit:function(t){var e=this;this.$iForm.show({title:"编辑活动奖品",frame:this.frame,form:t,success:function(i){e.$http.put("/yi-fan-shang/skus/".concat(t.uuid),{type:"update",attributes:i}).then((function(t){e.initList(),e.$iForm.hide()}))}})},handleCancel:function(){this.$emit("refresh"),this.$emit("close")},handleSave:function(){this.$emit("refresh"),this.$emit("close")},handleDelete:function(t){var e=this;this.$http.delete("/activities/".concat(this.uuid,"/skus/").concat(t.uuid)).then((function(t){e.$message.success("删除成功"),e.initList()}))},handleEditListWeight:function(t){var e=this;this.$iForm.show({title:"编辑排序",frame:[{title:"排序",key:"list_weight",type:"number"}],form:t,success:function(i){e.$http.put("/yi-fan-shang/skus/".concat(t.uuid),{type:"update",attributes:i}).then((function(t){e.initList(),e.$iForm.hide()}))}})}}},x=S,O=(i("016f"),Object(y["a"])(x,b,k,!1,null,"79d7e9eb",null)),j=O.exports,$=function(){var t=this,e=t._self._c;return e("a-modal",{staticStyle:{top:"100px"},attrs:{title:"编辑赠送赏",visible:!0,width:"1200px"},on:{cancel:t.handleCancel}},[e("div",{staticClass:"tips"}),e("a-table",{staticClass:"product-table",attrs:{rowKey:function(t){return t.id},dataSource:t.list,bordered:"",pagination:!1,size:"small"}},[e("a-table-column",{attrs:{title:"序号",width:"20px"},scopedSlots:t._u([{key:"default",fn:function(i,n,a){return[e("div",[t._v(t._s(a+1))])]}}])}),e("a-table-column",{key:"thumb",attrs:{title:"图片",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("div",{staticStyle:{display:"flex","align-items":"center"}},[e("img",{staticClass:"thumb",staticStyle:{"margin-right":"10px"},attrs:{src:i.thumb}}),e("div",[t._v("\n            "+t._s(i.title)+" "),e("br"),t._v("\n            "+t._s(i.number)+"\n          ")])])]}}])}),e("a-table-column",{key:"number",attrs:{title:"赏标题",width:"50px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("div",[t._v("\n          "+t._s(i.shang_title||"-")+"\n          ")])]}}])}),e("a-table-column",{key:"number",attrs:{title:"回收价",width:"100px"},scopedSlots:t._u([{key:"default",fn:function(t){return[e("div",[e("PriceDisplay",{attrs:{info:t}})],1)]}}])}),e("a-table-column",{key:"number",attrs:{title:"显示零售价",width:"100px"},scopedSlots:t._u([{key:"default",fn:function(i){return[i.display_money_price?e("div",[t._v("\n          "+t._s(i.display_money_price/100)+" 元\n          ")]):t._e()]}}])}),e("a-table-column",{key:"number",attrs:{title:"抽取位置",width:"100px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("div",[t._v("\n          第"+t._s(i.lottery_start_point)+" - 第"+t._s(i.lottery_end_point)+"发\n          "),e("br"),t._v("\n          取"+t._s(i.total_per_room)+"位送出\n        ")])]}}])}),e("a-table-column",{attrs:{title:"SKU类型",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[1===i.sku_type?e("span",[t._v("-")]):2===i.sku_type?e("span",[t._v("绑定商品")]):3===i.sku_type?e("span",[t._v("绑定虚拟资产")]):t._e()])]}}])}),e("a-table-column",{attrs:{width:"80px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[i.presell_date?e("span",[t._v(t._s(i.presell_date))]):e("span",[t._v("-")])])]}}])},[e("div",{attrs:{slot:"title"},slot:"title"},[t._v("\n        预售时间\n        "),e("tips",[t._v("设置后在预售时间前用户无法选择发货")])],1)]),t.selectMode?t._e():e("a-table-column",{attrs:{title:"排序",width:"60px"},scopedSlots:t._u([{key:"default",fn:function(i){return[t._v("\n        "+t._s(i.list_weight)+"\n        "),e("span",{staticStyle:{"margin-left":"10px"},on:{click:function(e){return t.handleEditListWeight(i)}}},[e("a",{attrs:{href:"javascript:;"}},[e("a-icon",{attrs:{type:"edit"}})],1)])]}}],null,!1,3403708818)}),e("a-table-column",{attrs:{title:"总库存",width:"60px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[t._v("\n          "+t._s(i.stock)+"件\n          ")])]}}])}),e("a-table-column",{attrs:{title:"每箱数量",width:"60px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[t._v("\n          "+t._s(i.total_per_room)+"件\n          ")])]}}])}),e("a-table-column",{attrs:{title:"操作",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleEdit(i)}}},[t._v("编辑")])]}}])})],1),e("template",{slot:"footer"},[e("div",{staticClass:"btn-c"},[e("div",{staticStyle:{"flex-grow":"1"}}),e("a-button",{key:"back",on:{click:t.handleCancel}},[t._v("关闭")])],1)])],2)},E=[];function C(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function P(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?C(Object(i),!0).forEach((function(e){Object(s["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):C(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var D={components:{UploadImages:g["a"],iSwitch:o["a"]},props:{info:{type:Object,default:function(){return{}}}},data:function(){return{list:[],frame:[{title:"SKU类型",key:"sku_type",type:"radio",default:1,required:!0,span:24,options:[{title:"无绑定",value:1},{title:"绑定商城中的商品",value:2},{title:"平台虚拟资产",value:3}],tips:"选择免单会按一抽的价格返还给中奖用户"},{title:"绑定商品",key:"product_id",type:"product_id",where:{sku_type:2}},{title:"绑定虚拟资产",key:"assets",type:"assets",where:{sku_type:3}},{title:"奖品名称",key:"title",required:!0,placeholder:'如"积分礼包1"'},{title:"编号",key:"number",placeholder:"填写编号方便在订单中对应货物"},{title:"赏标题",key:"shang_title",placeholder:"例如 A赏 B赏"},{title:"封面",key:"thumb",type:"image",tips:"建议宽600，高900"},{title:"回收价",key_prefix:"",type:"mix_price",tips:"价值用于回收时作为回收原价进行折扣计算",newline:!0,required:!0},{title:"显示零售价",key:"display_money_price",type:"price",tips:"零售价仅用于小程序显示， 选填",newline:!0},{title:"每个箱子数量",key:"total_per_room",type:"number",tips:"每个箱子内提供的奖品数量",required:!0},{title:"抽奖开始位置",key:"lottery_start_point",prefix:"从(包含)第",suffix:"位抽奖者开始",type:"number",required:!0},{title:"抽奖结束位置",key:"lottery_end_point",prefix:"至(包含)第",suffix:"位抽奖者结束",type:"number",required:!0},{title:"预售日期",key:"presell_date",showTime:!1,type:"date",tips:"设置此日期后，用户仓库内此奖品只能在预售日期之后才能进行发货"},{title:"奖品详情图",key:"detail_images",type:"images",newline:!0,sizeLimit:400,tips:"显示在用户的物品详情中。 不上传则不显示。 <br/> 长图请切成多张小图上传"}]}},watch:{uuid:function(){this.initList()}},created:function(){this.initList()},methods:{initList:function(){var t=this;this.$http.get("/yi-fan-shang/skus",{params:{shang_type:"gift",activity_id:this.info.id}}).then((function(e){t.list=e.data.list}))},handleCreate:function(){var t=this;this.$iForm.show({title:"新增活动奖品",frame:this.frame,success:function(e){t.$http.post("/yi-fan-shang/skus",P({},e)).then((function(e){t.initList(),t.$iForm.hide()}))}})},handleEdit:function(t){var e=this;this.$iForm.show({title:"编辑活动奖品",frame:this.frame,form:t,success:function(i){e.$http.put("/yi-fan-shang/skus/".concat(t.uuid),{type:"update",attributes:i}).then((function(t){e.initList(),e.$iForm.hide()}))}})},handleCancel:function(){this.$emit("refresh"),this.$emit("close")},handleSave:function(){this.$emit("refresh"),this.$emit("close")},handleDelete:function(t){var e=this;this.$http.delete("/activities/".concat(this.uuid,"/skus/").concat(t.uuid)).then((function(t){e.$message.success("删除成功"),e.initList()}))},handleEditListWeight:function(t){var e=this;this.$iForm.show({title:"编辑排序",frame:[{title:"排序",key:"list_weight",type:"number"}],form:t,success:function(i){e.$http.put("/yi-fan-shang/skus/".concat(t.uuid),{type:"update",attributes:i}).then((function(t){e.initList(),e.$iForm.hide()}))}})}}},L=D,F=(i("9ddb"),Object(y["a"])(L,$,E,!1,null,"43302ba8",null)),U=F.exports,q=function(){var t=this,e=t._self._c;return e("a-modal",{staticStyle:{top:"100px"},attrs:{title:"所有箱子",visible:!0,width:"1000px"},on:{cancel:t.handleCancel}},[e("a-table",{staticClass:"product-table",attrs:{rowKey:function(t){return t.id},dataSource:t.list,bordered:"",pagination:t.pagination,size:"small"}},[e("a-table-column",{key:"title",attrs:{title:"序号",width:"30px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[t._v("\n          第"+t._s(i.num)+"箱\n        ")])]}}])}),e("a-table-column",{key:"title",attrs:{title:"库存",width:"30px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[t._v("\n          剩 "+t._s(i.stock)+" 发\n        ")])]}}])}),e("a-table-column",{attrs:{title:"抽取记录",width:"160px"},scopedSlots:t._u([{key:"default",fn:function(i){return[i.open_records?e("div",t._l(i.open_records,(function(i,n){return e("span",{staticStyle:{"margin-left":"10px"}},[t._v("\n            "+t._s(i.open_index)+"."+t._s(i.shang_title)+"\n          ")])})),0):t._e()]}}])}),e("a-table-column",{attrs:{title:"操作",width:"40px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleEditOdds(i)}}},[t._v("编辑概率")])]}}])})],1),e("template",{slot:"footer"},[e("div",{staticClass:"btn-c"},[e("a-button",{staticClass:"add",attrs:{type:"primary"},on:{click:t.initList}},[t._v("\n        刷新数据\n      ")]),e("div",{staticStyle:{"flex-grow":"1"}}),e("a-button",{key:"back",on:{click:t.handleCancel}},[t._v("关闭")])],1)])],2)},I=[],T={components:{UploadImages:g["a"],iSwitch:o["a"]},props:{uuid:{type:String,default:function(){return""}},info:{type:Object,default:function(){return{}}}},data:function(){return{list:[],page:1,perPage:10,total:0}},watch:{uuid:function(){this.initList()}},computed:{pagination:function(){var t=this;return{defaultPageSize:this.perPage,defaultCurrent:this.page,total:this.total,onChange:function(e){t.page=e,t.initList()}}}},created:function(){this.initList()},methods:{initList:function(){var t=this;this.$http.get("/yifanshang/".concat(this.info.uuid,"/rooms"),{params:{page:this.page,per_page:this.perPage}}).then((function(e){t.list=e.data.list,t.total=e.data.item_total}))},handleEditOdds:function(t){this.$emit("editOdds",t)},handleCancel:function(){this.$emit("refresh"),this.$emit("close")},handleSave:function(){this.$emit("refresh"),this.$emit("close")},handleDelete:function(t){var e=this;this.$http.delete("/activities/".concat(this.uuid,"/skus/").concat(t.uuid)).then((function(t){e.$message.success("删除成功"),e.initList()}))}}},z=T,R=(i("b114"),Object(y["a"])(z,q,I,!1,null,"608227d5",null)),K=R.exports,G=function(){var t=this,e=t._self._c;return e("a-modal",{staticStyle:{top:"100px"},attrs:{title:"编辑第".concat(this.info.num,"箱概率"),visible:!0,width:"1100px"},on:{cancel:t.handleCancel}},[e("a-table",{staticClass:"product-table",attrs:{rowKey:function(t){return t.id},dataSource:t.list,bordered:"",pagination:!1,size:"small"}},[e("a-table-column",{attrs:{title:"赏标题",width:"20px"},scopedSlots:t._u([{key:"default",fn:function(i){return[0===i.shang_type?e("a-tag",{attrs:{color:"blue"}},[t._v(t._s(i.shang_title))]):e("a-tag",{attrs:{color:"orange"}},[t._v(t._s(i.shang_title))])]}}])}),e("a-table-column",{attrs:{title:"总次数",width:"60px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",{attrs:{color:"blue"}},[t._v(t._s(i.total_per_room))])]}}])}),e("a-table-column",{key:"thumb",attrs:{title:"概率",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(i){return[0===i.shang_type?e("a-input",{staticStyle:{width:"880px"},attrs:{placeholder:"填写指定出现的序号,多个使用空格隔开"},model:{value:i.target_index,callback:function(e){t.$set(i,"target_index",e)},expression:"row.target_index"}}):e("a-input",{staticStyle:{width:"880px"},attrs:{placeholder:"填写限制抽中的手机号,多个使用空格隔开"},model:{value:i.target_phone,callback:function(e){t.$set(i,"target_phone",e)},expression:"row.target_phone"}})]}}])})],1),e("template",{slot:"footer"},[e("div",{staticClass:"btn-c"},[e("div",{staticStyle:{"flex-grow":"1"}}),e("a-button",{key:"back",on:{click:t.handleCancel}},[t._v("取消")]),e("a-button",{key:"submit",attrs:{type:"primary"},on:{click:t.handleSave}},[t._v("\n        保存\n      ")])],1)])],2)},N=[],B={components:{UploadImages:g["a"],iSwitch:o["a"]},props:{uuid:{type:String,default:function(){return""}},info:{type:Object,default:function(){return{}}}},data:function(){return{list:[]}},watch:{uuid:function(){this.initList()}},created:function(){this.initList()},methods:{initList:function(){var t=this;this.$http.get("/yifanshang/odds?room_id=".concat(this.info.id)).then((function(e){t.list=e.data.list}))},handleCancel:function(){this.$emit("refresh"),this.$emit("close")},handleSave:function(){var t=this;this.$http.put("/yifanshang/odds",{room_id:this.info.id,list:this.list}).then((function(e){t.$message.success("保存成功"),t.$emit("refresh"),t.$emit("close")}))}}},M=B,W=(i("e335"),Object(y["a"])(M,G,N,!1,null,"9a2e26f0",null)),A=W.exports,J=(i("7f7f"),function(){var t=this,e=t._self._c;return e("a-modal",{staticStyle:{top:"100px"},attrs:{title:"所有抽取记录(".concat(this.total,"条)"),visible:!0,width:"1000px"},on:{cancel:t.handleCancel}},[e("a-table",{staticClass:"product-table",attrs:{rowKey:function(t){return t.id},dataSource:t.list,bordered:"",pagination:t.pagination,size:"small"}},[e("a-table-column",{key:"title",attrs:{title:"箱子序号",width:"40px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[t._v("\n          第"+t._s(i.options["room_num"])+"箱\n        ")])]}}])}),e("a-table-column",{key:"title",attrs:{title:"箱内抽取序号",width:"60px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[t._v("\n          "+t._s(i.open_index)+"\n        ")])]}}])}),e("a-table-column",{key:"title",attrs:{title:"编号",width:"20px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[t._v("\n          "+t._s(i.sid)+"\n        ")])]}}])}),e("a-table-column",{key:"title",attrs:{title:"标题",width:"90px"},scopedSlots:t._u([{key:"default",fn:function(i){return[0===i.options.shang_type?e("a-tag",{attrs:{color:"blue"}},[t._v(t._s(i.options.shang_title))]):e("a-tag",{attrs:{color:"orange"}},[t._v(t._s(i.options.shang_title))]),e("span",[t._v("\n          "+t._s(i.title)+"\n        ")])]}}])}),e("a-table-column",{key:"title",attrs:{title:"数量",width:"30px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[t._v("\n          "+t._s(i.total)+"\n        ")])]}}])}),e("a-table-column",{key:"title",attrs:{title:"状态",width:"60px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[t._v("\n          "+t._s(i.union_status_text)+"\n        ")])]}}])}),e("a-table-column",{key:"title",attrs:{title:"用户",width:"60px"},scopedSlots:t._u([{key:"default",fn:function(i){return[i.user?e("span",[t._v("\n          "+t._s(i.user.name)+"\n        ")]):t._e()]}}])}),e("a-table-column",{attrs:{title:"开取时间",width:"90px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[t._v("\n          "+t._s(i.created_at)+"\n        ")])]}}])})],1),e("template",{slot:"footer"},[e("div",{staticClass:"btn-c"},[e("div",{staticStyle:{"flex-grow":"1"}}),e("a-button",{key:"back",on:{click:t.handleCancel}},[t._v("关闭")])],1)])],2)}),H=[],Q={components:{UploadImages:g["a"],iSwitch:o["a"]},props:{uuid:{type:String,default:function(){return""}},info:{type:Object,default:function(){return{}}}},data:function(){return{list:[],page:1,perPage:15,total:0}},watch:{uuid:function(){this.initList()}},created:function(){console.log(this.info),this.initList()},computed:{pagination:function(){var t=this;return{defaultPageSize:this.perPage,defaultCurrent:this.page,total:this.total,onChange:function(e){t.page=e,t.initList()}}}},methods:{initList:function(){var t=this;this.$http.get("/asset/package-skus",{params:{page:this.page,per_page:this.perPage,node_type:"yfs"==this.info.type?"yifanshang":"shuangsuiji",node_id:this.info.id}}).then((function(e){t.list=e.data.list,t.total=e.data.item_total}))},handleCancel:function(){this.$emit("refresh"),this.$emit("close")},handleSave:function(){this.$emit("refresh"),this.$emit("close")},handleDelete:function(t){var e=this;this.$http.delete("/activities/".concat(this.uuid,"/skus/").concat(t.uuid)).then((function(t){e.$message.success("删除成功"),e.initList()}))}}},V=Q,X=(i("2163"),Object(y["a"])(V,J,H,!1,null,"262cc728",null)),Y=X.exports;function Z(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function tt(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Z(Object(i),!0).forEach((function(e){Object(s["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Z(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var et="yi-fan-shangs",it="一番赏",nt={components:{ISwitch:o["a"],Edit:m,EditNormalSku:j,EditGiftSku:U,EditRoom:K,EditOdds:A,EditPackageSku:Y},props:{selectMode:{type:Boolean},params:{type:Object},size:{type:String,default:"default"},type:{type:String,default:""}},data:function(){var t;return t={isEdit:!1,editUuid:"",current:{},currentRoom:{},isEditNormalSku:!1,isEditGiftSku:!1,isEditRoom:!1,isEditPackageSku:!1,isShowLotteryUserList:!1,isEditOdds:!1,resourceTypeText:it,exportOptions:{status:"all",startTime:"",endTime:"",type:"normal"},status:"unexpired",list:[],page:1,per_page:10,total:0,key:"",category_id:void 0,statusList:[{text:"上架中",key:"on_stock"},{text:"已下架",key:"off_stock"},{text:"售罄",key:"sell_out"}]},Object(s["a"])(t,"status","on_stock"),Object(s["a"])(t,"statusTotal",{on_stock:0,off_stock:0,sell_out:0,marked:0}),t},watch:{params:function(){this.refreshData()},category_id:function(){this.refreshData()},type:function(){this.refreshData()},status:function(){this.page=1,this.refreshData()}},computed:{pagination:function(){var t=this;return{defaultPageSize:this.per_page,defaultCurrent:this.page,total:this.total,onChange:function(e){t.page=e,t.fetchData()}}}},filters:{},created:function(){this.fetchData()},methods:{fetchTotalData:function(){var t=this;this.$http("/status-total/activity/yifanshang").then((function(e){t.statusTotal=e.data.total}))},handleEditOdds:function(t){this.isEditOdds=!0,this.currentRoom=t},getPath:function(t){this.$getPathPopup.show({page:"/pages/yifanshang/detail",param:"uuid="+t.uuid})},handleCopy:function(t){var e=this;this.$confirm({title:"确认要复制吗?",content:"复制后将创建一个全新的未上架的活动，当前活动不爱影响",onOk:function(){e.$http.patch("/".concat(et,"/").concat(t.uuid),{type:"copy"}).then((function(t){e.$message.success("复制成功，请在“已下架”列表中编辑活动"),e.status="off_stock",e.fetchData()}))}})},handleDelete:function(t){var e=this;this.$confirm({title:"提示",content:"确认删除吗？",onOk:function(){e.$http.delete("/".concat(et,"/").concat(t.uuid)).then((function(t){e.fetchData()}))}})},updateItem:function(t,e){return this.$http.patch("/".concat(et,"/").concat(t.uuid),{type:"update",attributes:tt({},e)})},recommendStatusChange:function(t,e){var i=this;this.updateItem(e,{is_recommend:t}).then((function(t){i.fetchData()}))},listedStatusChange:function(t,e){var i=this;this.updateItem(e,{status:t}).then((function(t){i.fetchData()}))},handleEditListWeight:function(t){var e=this;this.$globalForm.show({title:"编辑排序",items:[{type:"number",key:"list_weight",title:"排序",default:t.list_weight,required:!0}],success:function(i){e.updateItem(t,tt({},i)).then((function(t){e.$message.success("保存成功"),e.$globalForm.hide(),e.fetchData()}))}})},handleCreate:function(){this.editUuid="",this.isEdit=!0},handleEditNormalSku:function(t){this.editUuid=t.uuid,this.current=t,this.isEditNormalSku=!0},handleEditGiftSku:function(t){this.editUuid=t.uuid,this.current=t,this.isEditGiftSku=!0},handleShowPackageSku:function(t){this.editUuid=t.uuid,this.current=t,this.isEditPackageSku=!0},handleEditRoom:function(t){this.editUuid=t.uuid,this.current=t,this.isEditRoom=!0},showLotteryUserList:function(t){this.editUuid=t.uuid,this.isShowLotteryUserList=!0},handleEdit:function(t){this.editUuid=t.uuid,this.isEdit=!0},refreshData:function(){this.page=1,this.key="",this.fetchData()},onSearch:function(t){this.fetchData()},fetchData:function(){var t=this;this.isEdit=!1,this.$http.get("/".concat(et),{params:tt(tt({status:this.status},this.params),{},{page:this.page,per_page:this.per_page,key:this.key,category_id:this.category_id})}).then((function(e){t.list=e.data.list,t.total=e.data.item_total})).finally((function(){t.fetchTotalData(),t.loading=!1}))},getCategoryList:function(){var t=this;this.$api.emit("category.list","article").then((function(e){t.category=e.data.list}))}}},at=nt,st=(i("2d8b"),Object(y["a"])(at,n,a,!1,null,"187879e3",null));e["default"]=st.exports},a209:function(t,e,i){},a39b:function(t,e,i){},b0a5:function(t,e,i){"use strict";var n=i("b6c9");e["a"]=n["a"]},b114:function(t,e,i){"use strict";i("09b3")},d773:function(t,e,i){},e335:function(t,e,i){"use strict";i("d773")},e437:function(t,e,i){"use strict";i("8fe7")}}]);