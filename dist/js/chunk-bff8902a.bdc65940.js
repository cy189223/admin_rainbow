(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-bff8902a"],{"19af":function(t,e,i){},"49cd":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"content-wrap"},[e("div",{staticStyle:{"margin-bottom":"20px"}},[e("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:t.plusRoles}},[t._v("添加角色")])],1),e("a-table",{staticClass:"table",attrs:{rowKey:function(t){return t.uuid},dataSource:t.list,pagination:t.pagination,loading:t.loading},on:{change:t.handleTableChange}},[e("a-table-column",{key:"name",attrs:{title:"名称",dataIndex:"name"}}),e("a-table-column",{key:"description",attrs:{title:"描述",dataIndex:"description"}}),e("a-table-column",{key:"perm_codes",attrs:{title:"权限",width:"200px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleView(i)}}},[t._v("查看权限")])]}}])}),e("a-table-column",{key:"action",attrs:{title:"操作"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleEdit(i)}}},[t._v("编辑")]),e("a-divider",{attrs:{type:"vertical"}}),e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleDlete(i)}}},[t._v("删除")])],1)]}}])})],1),e("a-modal",{staticStyle:{top:"100px"},attrs:{title:"查看权限",visible:t.isView,width:"850px"},on:{ok:function(e){t.isView=!1},cancel:function(e){t.isView=!1}}},[e("div",{staticClass:"permission"},t._l(t.permissionsList,(function(i,a){return e("div",{key:a,staticClass:"item"},[e("div",{staticClass:"label"},[t._v(t._s(i.title)+"：")]),e("div",{staticClass:"value"},[e("a-checkbox-group",{model:{value:t.checkedList,callback:function(e){t.checkedList=e},expression:"checkedList"}},t._l(i.permissions,(function(a){return e("a-checkbox",{key:a.key,attrs:{disabled:"",value:"".concat(i.key,"_").concat(a.key)}},[t._v(t._s(a.title))])})),1)],1)])})),0)]),e("a-modal",{staticStyle:{top:"100px"},attrs:{title:t.actionTitle,visible:t.visible,width:"600px"},on:{ok:t.handleOk,cancel:t.handleCancel}},[e("a-form",{attrs:{form:t.form}},[e("a-form-item",{attrs:{label:"角色名称","label-col":{span:5},"wrapper-col":{span:12}}},[e("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:"请输入角色名称"}]}],expression:"[\n            'name',\n            {rules: [{ required: true, message: '请输入角色名称' }]}\n          ]"}]})],1),e("a-form-item",{attrs:{label:"角色描述","label-col":{span:5},"wrapper-col":{span:12}}},[e("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["description"],expression:"[\n            'description'\n          ]"}],attrs:{autosize:{minRows:2,maxRows:6}}})],1),e("a-form-item",{attrs:{label:"角色权限","label-col":{span:4},"wrapper-col":{span:24}}},[e("div",{staticClass:"permission"},t._l(t.permissionsList,(function(i,a){return e("div",{key:a,staticClass:"item"},[e("div",{staticClass:"label"},[t._v(t._s(i.title)+"：")]),e("div",{staticClass:"value"},[e("a-checkbox-group",{model:{value:t.checkedList,callback:function(e){t.checkedList=e},expression:"checkedList"}},t._l(i.permissions,(function(a){return e("a-checkbox",{key:a.key,attrs:{value:"".concat(i.key,"_").concat(a.key)}},[t._v(t._s(a.title))])})),1)],1)])})),0)])],1)],1)],1)},n=[],s=(i("7f7f"),i("ac6a"),i("bade")),c={},o={name:"Roles",data:function(){return{isView:!1,loading:!1,list:[],page:1,per_page:10,total:0,visible:!1,form:this.$form.createForm(this),checkedList:[],currentRole:{},actionType:0,permissionsList:s["a"]}},computed:{pagination:function(){return{defaultPageSize:this.per_page,defaultCurrent:this.page,total:this.total}},actionTitle:function(){return 0===this.actionType?"创建角色":"编辑角色"}},created:function(){s["a"].forEach((function(t){c[t.key]=[]})),this.fetch()},methods:{handleDlete:function(t){var e=this;this.$confirm({title:"提示",content:"确认删除角色 “".concat(t.name,"” ？"),onOk:function(){return new Promise((function(i,a){e.$api.emit("admin.role.destory",t.uuid).then((function(t){e.fetch(),i()})).catch((function(t){a(t)}))}))}})},handleView:function(t){this.isView=!0,this.currentRole=t,this.checkedList=JSON.parse(JSON.stringify(t.perm_codes))},handleEdit:function(t){var e=this;this.visible=!0,this.actionType=1,this.currentRole=t,this.$nextTick((function(){e.form.setFields({name:{value:t.name},description:{value:t.description}})})),this.checkedList=JSON.parse(JSON.stringify(t.perm_codes))},handleOk:function(){var t=this;this.form.validateFields(["name","description"],{force:!0},(function(e,i){if(!e){var a={name:i.name,description:i.description,perms:t.checkedList};0===t.actionType?t.$api.emit("admin.role.store",a).then((function(e){t.visible=!1,t.fetch()})):t.$api.emit("admin.role.update",t.currentRole.uuid,a).then((function(e){t.visible=!1,t.fetch()}))}}))},handleCancel:function(){this.visible=!1},plusRoles:function(){this.visible=!0,this.actionType=0,this.checkedList=[],this.form.resetFields()},handleTableChange:function(t,e,i){this.page=t.current,this.fetch()},fetch:function(){var t=this;this.loading=!0,this.$api.emit("admin.role.list",{page:this.page,per_page:this.per_page}).then((function(e){t.list=e.data.list,t.total=e.data.item_total})).finally((function(){t.loading=!1}))}}},r=o,l=(i("a2e9"),i("2877")),u=Object(l["a"])(r,a,n,!1,null,"36c9dd90",null);e["default"]=u.exports},a2e9:function(t,e,i){"use strict";i("19af")}}]);