(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-9b3e003c"],{"09d1":function(t,e,a){},2612:function(t,e,a){"use strict";a.d(e,"a",(function(){return s})),a.d(e,"b",(function(){return r}));var n=a("b775"),i="/users";function s(t){return Object(n["b"])({url:i,method:"get",params:t})}function r(t,e){return Object(n["b"])({url:"".concat(i,"/").concat(e),method:"patch",data:{type:"update",attributes:t}})}},5046:function(t,e,a){"use strict";a("09d1")},"55dd":function(t,e,a){"use strict";var n=a("5ca1"),i=a("d8e8"),s=a("4bf8"),r=a("79e5"),o=[].sort,c=[1,2,3];n(n.P+n.F*(r((function(){c.sort(void 0)}))||!r((function(){c.sort(null)}))||!a("2f21")(o)),"Array",{sort:function(t){return void 0===t?o.call(s(this)):o.call(s(this),i(t))}})},"9b4f":function(t,e,a){"use strict";a("d129")},b0a5:function(t,e,a){"use strict";var n=a("b6c9");e["a"]=n["a"]},c452:function(t,e,a){"use strict";a.r(e);a("7f7f"),a("ac6a");var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"user-list"},[e("div",{staticClass:"content-head",staticStyle:{"margin-bottom":"20px"}},[e("div",{staticClass:"sort-keys"},[e("div",{staticClass:"tab-list"},t._l(t.statusList,(function(a,n){return e("div",{staticClass:"item",class:{actived:t.keys.type===a.key},on:{click:function(e){t.keys.type=a.key}}},[t._v("\n           "+t._s(a.text)+"\n           ("+t._s(t.statusTotal[a.key])+")\n         ")])})),0),e("a-select",{staticStyle:{width:"150px","margin-right":"10px"},attrs:{placeholder:"分销级别",allowClear:""},model:{value:t.keys.agent_level,callback:function(e){t.$set(t.keys,"agent_level",e)},expression:"keys.agent_level"}},[t._l(t.agentLevelList,(function(a){return[e("a-select-option",{key:a.id,attrs:{value:a.id}},[t._v(t._s(a.title))])]}))],2),e("a-input-search",{staticStyle:{width:"180px","margin-right":"10px"},attrs:{placeholder:"用户名/手机号","enter-button":"",allowClear:"",size:t.size},on:{input:t.onSearch,search:t.onSearch},model:{value:t.key,callback:function(e){t.key=e},expression:"key"}})],1),e("div",{staticStyle:{"margin-top":"4px"}},[e("a-button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary"},on:{click:function(e){t.isExport=!t.isExport}}},[t._v("导出Excel")])],1)]),e("a-table",{staticClass:"table",attrs:{rowKey:function(t){return t.uuid},dataSource:t.list,pagination:t.pagination},on:{change:t.onPaginationChange}},[e("a-table-column",{key:"name",attrs:{title:"姓名",width:"180px"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"user"},[e("img",{staticClass:"headimg",attrs:{src:a.headimg,alt:"用户头像"}}),e("div",{staticClass:"right"},[e("div",{staticClass:"top"},[e("span",[t._v(t._s(a.name))]),"男"===a.gender?e("a-icon",{staticClass:"gender-man",attrs:{type:"man"}}):"女"===a.gender?e("a-icon",{staticClass:"gender-woman",attrs:{type:"woman"}}):t._e(),e("a",{staticStyle:{"margin-left":"10px"},attrs:{href:"javascript:;"},on:{click:function(e){return t.handleEdit(a)}}},[t._v("编辑")])],1),e("div",{staticClass:"bottom",staticStyle:{"margin-top":"4px"}},[e("span",{staticClass:"marked-tag",class:{actived:a.marked_at},on:{click:function(e){return t.markItem(a)}}},[t._v("标记")]),e("span",[t._v(t._s(a.phone))]),2===a.status?e("a-tag",{staticStyle:{"margin-left":"10px"},attrs:{color:"red"}},[t._v("已拉黑")]):t._e()],1)])])]}}])}),e("a-table-column",{attrs:{title:"邀请关系",width:"160px"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",[e("div",[t._v("\n            上级:\n            "),a.inviter?[e("img",{staticClass:"inviter-headimg",attrs:{src:a.inviter.headimg,alt:"用户头像"}}),t._v("\n              "+t._s(a.inviter.name)+"\n            ")]:[t._v("-")]],2),e("div",[t._v("直接粉丝: "+t._s(a.direct_invitees_count)+"人")]),e("div",[t._v("间接粉丝: "+t._s(a.indirect_invitees_count)+"人")])])]}}])}),e("a-table-column",{attrs:{title:"分销等级",width:"70px"},scopedSlots:t._u([{key:"default",fn:function(a){return[a.agent_level?e("span",[t._v(t._s(a.agent_level.title))]):e("span",[t._v(t._s(a.agent_level_index))])]}}])}),e("a-table-column",{attrs:{title:"资产",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",[t._v("积分: "+t._s(a.score))]),e("div",[t._v("红包: "+t._s(a.redpack/100)+"元")])]}}])}),e("a-table-column",{attrs:{title:"已结算佣金",width:"100px"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",[t._v("积分: "+t._s(a.completed_score_brokerage))]),e("div",[t._v("红包: "+t._s(a.completed_money_brokerage/100)+"元")])]}}])}),e("a-table-column",{attrs:{title:"待结算佣金",width:"100px"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",[t._v("积分: "+t._s(a.pending_score_brokerage))]),e("div",[t._v("红包: "+t._s(a.pending_money_brokerage/100)+"元")])]}}])}),e("a-table-column",{key:"created_at",attrs:{title:"注册日期",dataIndex:"created_at",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",[t._v(t._s(t._f("formatDate2")(a)))])]}}])}),e("a-table-column",{key:"last_active_at",attrs:{title:"最后活跃",dataIndex:"last_active_at",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",[t._v(t._s(t._f("formatDate")(a)))])]}}])}),e("a-table-column",{attrs:{width:"40px"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("ISwitch",{attrs:{value:a.agent_status,active:1,unactive:0},on:{change:function(e){return t.statusChange(e,a)}}})]}}])},[e("div",{attrs:{slot:"title"},slot:"title"},[t._v("\n        分销状态\n        "),e("tips",[t._v("开启时为正常状态 "),e("br"),t._v("  关闭后为禁用状态，禁用后无法获得佣金")])],1)]),e("a-table-column",{key:"action",attrs:{title:"操作",width:"150px"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",[e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleEditAgentLevel(a)}}},[t._v("修改分销级别")]),e("a-divider",{attrs:{type:"vertical"}}),2!==a.status?e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleBlockUser(a)}}},[t._v("拉黑")]):e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleUnblockUser(a)}}},[t._v("取消拉黑")])],1)]}}])})],1),e("ExportPopup",{attrs:{isShow:t.isExport},on:{hide:function(e){t.isExport=!1}}})],1)},i=[],s=(a("8e6e"),a("456d"),a("55dd"),a("ade3")),r=a("2612"),o=a("c1df"),c=a.n(o),l=function(){var t=this,e=t._self._c;return e("a-modal",{staticStyle:{top:"100px"},attrs:{title:"导出分销员数据",visible:t.isShow,width:"600px",okText:"确认导出"},on:{ok:t.handleOk,cancel:t.handleCancel}},[e("IForm",{staticClass:"form-container",attrs:{formFrame:t.frame,formData:t.form},on:{"update:formData":function(e){t.form=e},"update:form-data":function(e){t.form=e}}}),t._v("\n  共查询到 "+t._s(t.itemTotal)+" 个有邀请记录的分销员\n")],1)},u=[],f=a("2f62"),d=(a("9fb0"),a("b0a5"));function p(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function h(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?p(Object(a),!0).forEach((function(e){Object(s["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var v={components:{IForm:d["a"]},props:{isShow:{type:Boolean}},computed:h(h({},Object(f["c"])(["baseUrl"])),{},{uploadUrl:function(){return"".concat(this.baseUrl,"/admin-api/batch-deliver")},frame:function(){return[{title:"手机号",key:"user_phone",tips:"填入手机号，不填则导出所有记录"},{type:"number",key:"per_page",title:"每页条数",default:1e3},{type:"number",key:"page",title:"要导出的页码",tips:"填5则导出第5页",default:1}]}}),data:function(){return{form:{abc:"abc"},itemTotal:0}},watch:{form:{handler:function(t,e){var a=this;this.$http.post("/export/agent/total",this.form).then((function(t){a.itemTotal=t.data.total}))},deep:!0}},mounted:function(){var t=this;this.$http.post("/export/agent/total",this.form).then((function(e){t.itemTotal=e.data.total}))},methods:{handleChange:function(t){t.file,t.fileList},handleOk:function(){this.$http.post("/export/agent",h({},this.form)).then((function(t){var e=window.open();e.location=Object({NODE_ENV:"production",BASE_URL:"/"}).VUE_APP_BASE_URL+"".concat(t.data.url)})).finally((function(){}))},handleCancel:function(){this.$emit("hide")}}},m=v,y=(a("5046"),a("2877")),_=Object(y["a"])(m,l,u,!1,null,"3d36eba0",null),g=_.exports,b=a("7cc6");function k(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function w(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?k(Object(a),!0).forEach((function(e){Object(s["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):k(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var O={name:"UserList",components:{ExportPopup:g,ISwitch:b["a"]},data:function(){return{statusList:[{text:"全部",key:"level1"},{text:"拉黑的",key:"blocked"}],keys:{type:"level1",agent_level:void 0},statusTotal:{level1:0,blocked:0},loading:!1,list:[],page:1,per_page:10,total:0,key:"",sort:"time",form:this.$form.createForm(this),visible:!1,confirmLoading:!1,timeout:null,isExport:!1,agentLevelList:[]}},computed:{pagination:function(){return{defaultPageSize:this.per_page,defaultCurrent:this.page,total:this.total,showTotal:function(t){return"共 ".concat(t," 条")}}}},filters:{formatDate:function(t){return t?c()(t).fromNow():""},formatDate2:function(t){return t?c()(t).format("YYYY-MM-DD"):""}},created:function(){this.fetchData(),this.fetchTotalData(),this.fetchLevelList()},watch:{sort:function(t){this.fetchData()},keys:{handler:function(t){this.refresh()},deep:!0}},methods:{statusChange:function(t,e){var a=this;this.$http.patch("/agents/".concat(e.uuid),{type:"update_agent_status",agent_status:t}).then((function(t){a.fetchData(),a.fetchTotalData()}))},handleBlockUser:function(t){var e=this;this.$confirm({title:"确认要拉黑用户吗",content:"拉黑后用户能正常浏览页面，但不能进行需要登录的操作，如下单、加购物车，同时不结算佣金。",onOk:function(){e.$http.patch("/users/".concat(t.uuid),{type:"block"}).then((function(t){e.fetchData(),e.fetchTotalData()}))}})},handleUnblockUser:function(t){var e=this;this.$confirm({title:"提示",content:"确认要取消拉黑用户吗？",onOk:function(){e.$http.patch("/users/".concat(t.uuid),{type:"unblock"}).then((function(t){e.fetchData(),e.fetchTotalData()}))}})},markItem:function(t){var e=this;this.$http.patch("/users/".concat(t.uuid),{type:"mark"}).then((function(t){e.$message.success("保存成功"),e.fetchData(),e.fetchTotalData()}))},onPaginationChange:function(t){this.page=t.current,this.per_page=t.pageSize,this.fetchData()},refresh:function(){this.page=1,this.key="",this.fetchData(),this.fetchTotalData()},onSearch:function(t){var e=this;this.page=1,clearTimeout(this.timeout),this.timeout=setTimeout((function(){e.fetchData()}),300)},handleEditAgentLevel:function(t){var e=this,a=this.agentLevelList.map((function(t){return{title:t.title,value:t.level}}));this.$iForm.show({title:"修改分销级别",frame:[{type:"select",key:"agent_level",options:a,title:"分销级别",required:!0,default:t.agent_level_index}],success:function(a){e.$http({url:"/agents/".concat(t.uuid),method:"PATCH",data:w({type:"update_agent_level"},a)}).then((function(t){e.$message.success("操作成功"),e.$iForm.hide(),e.fetchData()}))}})},handleAddScore:function(t){var e=this;this.$iForm.show({title:"修改用户积分",frame:[{type:"radio",key:"type",options:[{title:"增加",value:"in"},{title:"减少",value:"out"}],title:"变动类型",required:!0},{type:"number",key:"score",title:"变动数量",required:!0},{type:"textarea",key:"description",title:"变动原因",tips:"变动原因会显示在用户的积分流水记录中",required:!0}],success:function(a){e.$http({url:"/users/".concat(t.uuid,"/score"),method:"PATCH",data:w({type:"add"},a)}).then((function(t){e.$message.success("操作成功"),e.$iForm.hide(),e.fetchData()}))}})},handleEdit:function(t){var e=this;this.$iForm.show({title:"修改用户信息",frame:[{type:"input",key:"name",title:"用户名",default:t.name,required:!0},{type:"input",key:"phone",title:"手机号",default:t.phone},{type:"input",key:"city",title:"地区",default:t.city},{type:"textarea",key:"remark",title:"备注",default:t.remark}],success:function(a){e.$http({url:"/users/".concat(t.uuid),method:"PATCH",data:{type:"update",attributes:a}}).then((function(t){e.$message.success("更新成功"),e.$iForm.hide(),e.fetchData()}))}})},handleOk:function(){var t=this;this.form.validateFields((function(e,a){e||(t.confirmLoading=!0,Object(r["b"])(a,t.current.uuid).then((function(e){t.visible=!1,t.fetchData()})).finally((function(){t.confirmLoading=!1})))}))},fetchLevelList:function(){var t=this;this.$http("/agent-levels").then((function(e){t.agentLevelList=e.data.list}))},fetchTotalData:function(){var t=this;this.$http.get("/status-total/agent",{params:{key:this.key,sort:this.sort,type:this.keys.type,agent_level:this.keys.agent_level}}).then((function(e){t.statusTotal=e.data.total}))},fetchData:function(){var t=this;this.loading=!0,this.$http.get("/agents",{params:{page:this.page,per_page:this.per_page,key:this.key,sort:this.sort,type:this.keys.type,agent_level:this.keys.agent_level}}).then((function(e){t.list=e.data.list,t.total=e.data.item_total})).finally((function(){t.loading=!1}))}}},x=O,D=(a("9b4f"),Object(y["a"])(x,n,i,!1,null,"551d750e",null));e["default"]=D.exports},d129:function(t,e,a){}}]);