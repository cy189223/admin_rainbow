(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2525e92c"],{"4ac7":function(t,e,i){"use strict";i("8563")},5901:function(t,e,i){"use strict";i("9eb3")},"6f0f":function(t,e,i){"use strict";i("f006")},"71c6":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[e("div",{staticClass:"row",staticStyle:{overflow:"hidden"}},[e("a-input",{staticStyle:{width:"210px","margin-right":"10px"},attrs:{allowClear:"",placeholder:"订单号/商品/用户名/手机号"},model:{value:t.key,callback:function(e){t.key=e},expression:"key"}}),e("a-button",{attrs:{type:"primary"},on:{click:t.refresh}},[t._v("刷新")]),e("a",{staticStyle:{"margin-left":"10px"},attrs:{href:"javascript:;"},on:{click:function(e){t.isFilter=!t.isFilter}}},[t._v("高级筛选")]),e("a-button",{staticStyle:{"margin-left":"30px",float:"right"},attrs:{type:"primary"},on:{click:function(e){t.isExport=!t.isExport}}},[e("span",[t._v("导出Excel")])]),e("a-button",{staticStyle:{"margin-left":"10px",float:"right"},attrs:{type:"primary"},on:{click:function(e){t.isBatchDeliver=!0}}},[t._v("\n      批量发货\n    ")])],1),t.isFilter?e("div",{staticClass:"filter-c"},[e("div",[e("span",{staticClass:"key"},[t._v("下单时间: ")]),e("iDatePicker",{staticStyle:{"margin-left":"10px"},attrs:{showTime:""},model:{value:t.filter.start_at,callback:function(e){t.$set(t.filter,"start_at",e)},expression:"filter.start_at"}}),e("span",{staticStyle:{"margin-left":"10px"}},[t._v("至")]),e("iDatePicker",{staticStyle:{"margin-left":"10px"},attrs:{showTime:""},model:{value:t.filter.end_at,callback:function(e){t.$set(t.filter,"end_at",e)},expression:"filter.end_at"}})],1),e("div",{staticStyle:{"margin-left":"20px"}},[e("span",{staticClass:"key"},[t._v("商品金额: ")]),e("a-input",{staticStyle:{width:"80px"},attrs:{placeholder:"元"},model:{value:t.filter.money_price_min,callback:function(e){t.$set(t.filter,"money_price_min",e)},expression:"filter.money_price_min"}}),e("span",{staticStyle:{margin:"0px 6px"}},[t._v("至")]),e("a-input",{staticStyle:{width:"80px"},attrs:{placeholder:"元"},model:{value:t.filter.money_price_max,callback:function(e){t.$set(t.filter,"money_price_max",e)},expression:"filter.money_price_max"}})],1),e("a-button",{staticStyle:{"margin-left":"10px",float:"right"},attrs:{type:"primary"},on:{click:t.refresh}},[t._v("\n      筛选\n    ")])],1):t._e(),e("div",{staticClass:"tab-list"},t._l(t.statusList,(function(i,a){return e("div",{staticClass:"item",class:{actived:t.status===i.key},on:{click:function(e){t.status=i.key}}},[t._v("\n      "+t._s(i.text)+" ("+t._s(t.orderStat[i.key]||0)+")\n    ")])})),0),e("div",{staticClass:"order-list"},[t._l(t.list,(function(i,a){return e("OrderItem",{key:i.id,attrs:{info:i},on:{mark:function(e){return t.handleMark(a)},"set-remark":function(e){return t.handleSetRemark(a)},"set-address":function(e){return t.handleSetAddress(a)},"edit-deliver-info":function(e){return t.handleEditDeliverInfo(a)},actions:function(e){return t.handleActions(e,a)}}})})),t.list.length?t._e():e("NoData"),t.list.length?e("a-pagination",{attrs:{showSizeChanger:!0,showTotal:function(t){return"共 ".concat(t," 条")},defaultCurrent:t.page,total:t.itemTotal,pageSize:t.perPage},on:{showSizeChange:t.onShowSizeChange,change:t.pageChange},model:{value:t.page,callback:function(e){t.page=e},expression:"page"}}):t._e()],2),e("BatchDeliver",{attrs:{isShow:t.isBatchDeliver},on:{success:t.batchDeliverSuccess,hide:function(e){t.isBatchDeliver=!1}}}),e("ExportPopup",{attrs:{isShow:t.isExport},on:{hide:function(e){t.isExport=!1}}}),t.isAftersale?e("AftersalePopup",{attrs:{order:t.current,isShow:t.isAftersale},on:{refresh:function(e){return t.fresh()},hide:function(e){t.isAftersale=!1}}}):t._e()],1)},s=[],r=(i("8e6e"),i("ac6a"),i("456d"),i("ade3")),n=(i("7f7f"),function(){var t=this,e=t._self._c;return e("div",{staticClass:"order-item"},[e("div",{staticClass:"order-item-top"},[e("a-icon",{staticClass:"star",attrs:{type:"star",theme:t.info.marked_at?"filled":"outlined"},on:{click:t.markOrder}}),e("div",{staticStyle:{"margin-left":"10px"}},[t._v(t._s(t.info.number))]),e("div",[e("a-tag",{attrs:{color:t.statusColors[t.info.union_status]}},[t._v(t._s(t.info.union_status_text))]),t.info.closed_reason?e("span",{staticStyle:{"font-weight":"500","font-size":"90%"}},[t._v(t._s(t.info.closed_reason))]):t._e(),t.info.activity_type_text?e("a-tag",[t._v(t._s(t.info.activity_type_text))]):t._e()],1),"package"===t.info.type?e("div",[t._v("提货时间:"),e("span",{staticClass:"value"},[t._v(t._s(t._f("dateFormat")(t.info.created_at)))])]):e("div",[t._v("领取时间:"),e("span",{staticClass:"value"},[t._v(t._s(t._f("dateFormat")(t.info.created_at)))])]),t.info.offline_use_at?e("div",[t._v("核销时间:"),e("span",{staticClass:"value"},[t._v(t._s(t._f("dateFormat")(t.info.offline_use_at)))])]):t._e(),t.info.closed_at?e("div",[t._v("关闭时间:"),e("span",{staticClass:"value"},[t._v(t._s(t._f("dateFormat")(t.info.closed_at)))])]):t._e()],1),e("div",{staticClass:"products"},[e("div",{staticClass:"product-item"},[e("img",{staticClass:"thumb",attrs:{src:t.info.goods_image+"?x-oss-process=image/resize,w_400"}}),e("div",{staticClass:"content"},[e("div",{staticClass:"info-detail"},[e("div",{staticClass:"product-title"},[e("a",{attrs:{href:"javascript:;"}},[t._v(t._s(t.info.goods_name))]),e("span",{staticClass:"node-type-text"},[t._v(t._s(t.info.level_name)+"奖品")]),t.info.pay_order_number?e("span",{staticClass:"value",staticStyle:{color:"gray","margin-left":"10px"}},[t._v("支付订单:"+t._s(t.info.pay_order_number))]):t._e(),t.info.supplier?e("span",{staticClass:"value",staticStyle:{color:"gray","margin-left":"10px"}},[t._v(t._s(t.info.supplier))]):t._e()])]),e("div",{staticClass:"attrs"},[e("span",[t._v(t._s(t.info.goods_desc))])])])])]),e("div",{staticClass:"user-info-wrapper"},[t.info.user?e("div",{staticClass:"user-info-content"},[e("img",{staticClass:"headimg",attrs:{src:t.info.user.headimg,alt:""}}),e("div",{staticClass:"user-ame"},[t._v(t._s(t.info.user.name))]),t.info.user.phone?e("div",{staticClass:"user-phone",staticStyle:{"margin-left":"16px"}},[t._v(t._s(t.info.user.phone))]):t._e(),e("div",{staticStyle:{"margin-left":"10px"}},["ali"===t.info.user.client_type?e("a-tag",{attrs:{color:"red"}},[t._v("天猫用户")]):t._e()],1),t.info.address?e("div",{staticClass:"address"},[e("a",{attrs:{href:"javascript:;"}},[e("a-icon",{staticStyle:{"padding-right":"4px"},attrs:{type:"user"}})],1),e("span",[t._v(t._s(t.info.real_name)+"  ")]),e("span",[t._v(t._s(t.info.mobile))]),t._v("  \n          "),e("span",[t._v(t._s(t.info.address))]),t._v(" \n          ")]):t._e()]):t._e()]),e("div",{staticClass:"remark"},[t.info.remark?e("div",[t._v("订单备注："+t._s(t.info.remark))]):t._e()]),t.info.deliver_record?e("div",{staticClass:"deliver"},[e("span",[t._v("订单发货:  \n        "),"express"===t.info.deliver_record.type?[t._v("\n          "+t._s(t.info.deliver_record.express_name)+"  "+t._s(t.info.deliver_record.express_number)+"\n          "),t.info.deliver_record.remark?[t._v("\n            ("+t._s(t.info.deliver_record.remark)+")\n          ")]:t._e()]:[t._v("\n          (无需物流)"+t._s(t.info.deliver_record.remark)+"\n        ")]],2),e("span",[t._v("  "+t._s(t.info.deliver_record.updated_at))]),e("a",{staticStyle:{"margin-left":"10px"},attrs:{href:"javascript:;"},on:{click:t.handleEditDeliverInfo}},[e("a-icon",{attrs:{type:"edit"}})],1)]):t._e(),t.info.aftersale?e("div",{staticClass:"aftersale"},[e("div",[e("span",[t._v("售后进度："),e("a-tag",{attrs:{color:t.colorMap[t.info.aftersale.union_status]}},[t._v(t._s(t.info.aftersale.union_status_text||""))])],1),t._v(" \n        "),e("span",[t._v(t._s(t.info.aftersale.reason||""))]),t._v(" \n        "),e("span",[t._v("(发起于"+t._s(t.info.aftersale.created_at||"")+")")]),t._v(" \n        "),e("a-button",{staticStyle:{"margin-right":"10px"},attrs:{size:"small",type:"primary"},on:{click:function(e){return t.handleActions("查看售后")}}},[e("span",[t._v("查看售后")])])],1)]):t._e(),e("div",{staticClass:"actions"},["deliver_pending"===t.info.union_status?[e("a-button",{staticStyle:{"margin-right":"10px"},attrs:{size:"small",type:"primary"},on:{click:function(e){return t.handleActions("订单发货")}}},[e("span",[t._v("订单发货")])])]:t._e(),"close_pending"===t.info.union_status?[e("a-button",{staticStyle:{"margin-right":"15px"},attrs:{size:"small",type:"danger"},on:{click:function(e){return t.handleActions("退款并关闭")}}},[e("span",[t._v("同意退款")])]),e("a-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){return t.handleActions("取消退款")}}},[e("span",[t._v("取消退款")])])]:t._e()],2)])}),o=[],c=i("c1df"),l=i.n(c),u={name:"OrderItem",props:{info:{type:Object,default:function(){return{}}}},data:function(){return{statusColors:{pay_pending:"#F56C6C",deliver_pending:"#E6A23C",delivered:"#1890FF",completed:"#67C23A",comment_pending:"#2BA246",closed:"#909399",close_pending:"red"},visible:!1,colorMap:{audit_rejected:"red",completed:"green"}}},filters:{dateFormat:function(t){return l()(t).format("YYYY-MM-DD HH:mm")},priceToFixed:function(t){return t?(t/100).toFixed(2):"0.00"}},methods:{markOrder:function(){this.$emit("mark")},handleEditDeliverInfo:function(){this.$emit("edit-deliver-info")},handleSetAddress:function(){this.$emit("set-address")},handleSetRemark:function(){this.$emit("set-remark")},handleActions:function(t){this.$emit("actions",t)}}},p=u,d=(i("5901"),i("2877")),f=Object(d["a"])(p,n,o,!1,null,"5e3acc0a",null),h=f.exports,_=i("b30f"),m=function(){var t=this,e=t._self._c;return e("a-modal",{staticStyle:{top:"100px"},attrs:{title:"批量发货",visible:t.isShow,width:"600px",okText:"确认批量发货",destroyOnClose:!0},on:{ok:t.handleOk,cancel:t.handleCancel}},[e("a-form",[e("a-form-item",{attrs:{label:"Excel文件","label-col":{span:5},"wrapper-col":{span:19},confirmText:"批量发货"}},[e("a-upload",{attrs:{name:"excel",action:t.uploadUrl,beforeUpload:t.beforeUpload,headers:t.headers},on:{change:t.handleChange}},[e("a-button",[e("a-icon",{attrs:{type:"upload"}}),t._v(" 上传Excel文件\n        ")],1)],1),e("div",{staticClass:"tips"},[t._v("\n        一共5列: 请下载下方格式示例（第一行表头将被忽略）\n        "),e("div",[e("a",{attrs:{target:"_blank",href:"http://hquesoft.oss-cn-shenzhen.aliyuncs.com/box/%E6%89%B9%E9%87%8F%E5%8F%91%E8%B4%A7%E5%AF%BC%E5%85%A5%E7%A4%BA%E4%BE%8B.xlsx"}},[t._v("\n        \t\tExcel格式示例\n        \t")])])])],1),e("a-form-item",{attrs:{label:"有效行数","label-col":{span:5},"wrapper-col":{span:19}}},[e("span",[t._v(t._s(t.rowTotal))])]),e("a-form-item",{attrs:{label:"可正常发货订单数","label-col":{span:5},"wrapper-col":{span:19}}},[e("span",[t._v(t._s(t.orderTotal))])]),t.info.not_found_rows&&0!=t.info.not_found_rows.length?e("a-form-item",{attrs:{label:"编号不存在的行:","label-col":{span:5},"wrapper-col":{span:19}}},[e("span",{staticStyle:{color:"red"}},[t._v(t._s(t.info.not_found_rows))])]):t._e(),t.info.not_deliver_pending_rows&&0!=t.info.not_deliver_pending_rows.length?e("a-form-item",{attrs:{label:"不是待发货的行","label-col":{span:5},"wrapper-col":{span:19}}},[e("span",{staticStyle:{color:"red"}},[t._v(t._s(t.info.not_deliver_pending_rows))])]):t._e()],1)],1)},v=[],y=i("2f62"),b=i("9fb0");function g(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,a)}return i}function k(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?g(Object(i),!0).forEach((function(e){Object(r["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):g(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var x={components:{},props:{isShow:{type:Boolean}},computed:k(k({},Object(y["c"])(["baseUrl"])),{},{uploadUrl:function(){return"".concat(this.baseUrl,"/admin-api/batch-deliver")}}),data:function(){return{submitUuid:"",rowTotal:0,orderTotal:0,info:{},headers:{Authorization:this.$ls.get(b["a"])},labelCol:{span:6},wrapperCol:{span:18}}},methods:{beforeUpload:function(t,e){this.rowTotal=0,this.orderTotal=0,this.submitUuid=""},handleChange:function(t){var e=t.file;t.fileList;if(e.response){if(409==e.response.status_code)return this.$message.warning("Excel格式不正确，请参考示例Excel修改后上传"),!1;if(500==e.response.status_code)return this.$message.warning("上传失败，请检查Excel格式"),!1;var i=e.response.data;this.rowTotal=i.row_total,this.orderTotal=i.order_total,this.submitUuid=i.uuid,this.info=i}},handleOk:function(){var t=this;if(!this.submitUuid||!this.orderTotal)return this.$message.warning("未匹配到可发货订单，请重新选择文件"),!1;this.$http({url:"/submit-batch-deliver",method:"POST",data:{uuid:this.submitUuid}}).then((function(e){t.$message.success("批量发货成功"),t.$emit("success")}))},handleCancel:function(){this.submitUuid="",this.info={},this.rowTotal=0,this.orderTotal=0,this.$emit("hide")}}},C=x,w=(i("819e"),Object(d["a"])(C,m,v,!1,null,"5fc9ba36",null)),O=w.exports,S=function(){var t=this,e=t._self._c;return e("a-modal",{staticStyle:{top:"100px"},attrs:{title:"导出订单",visible:t.isShow,width:"600px",okText:"确认导出"},on:{ok:t.handleOk,cancel:t.handleCancel}},[e("IForm",{staticClass:"form-container",attrs:{formFrame:t.frame,formData:t.form},on:{"update:formData":function(e){t.form=e},"update:form-data":function(e){t.form=e}}}),t._v("\n  共查询到 "+t._s(t.itemTotal)+" 条订单\n")],1)},$=[],j=i("b0a5");function D(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,a)}return i}function P(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?D(Object(i),!0).forEach((function(e){Object(r["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):D(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var E={components:{IForm:j["a"]},props:{isShow:{type:Boolean}},computed:P(P({},Object(y["c"])(["baseUrl"])),{},{uploadUrl:function(){return"".concat(this.baseUrl,"/admin-api/batch-deliver")},frame:function(){return[{title:"订单类型",key:"type",type:"select",newline:!0,required:!0,options:this.orderTypeList},{title:"订单状态",key:"status",type:"select",newline:!0,required:!0,options:this.statusList},{title:"包含SKU",key:"sku_number",newline:!0,placeholder:"输入SKU编号"},{title:"创建时间(始)",key:"created_at_start",type:"date",newline:!0},{title:"创建时间(未)",key:"created_at_end",type:"date",newline:!0},{title:"支付时间(始)",key:"paid_at_start",type:"date",newline:!0},{title:"支付时间(未)",key:"paid_at_end",type:"date",newline:!0}]}}),data:function(){return{form:{type:"all",status:"all",start_at:"",end_at:""},itemTotal:0,orderTypeList:[{title:"全部类型",value:"all"},{title:"提货订单",value:"package"},{title:"商城订单",value:"product"},{title:"活动订单",value:"activity"},{title:"VIP订单",value:"vip"},{title:"充值订单",value:"asset"}],statusList:[{title:"全部状态",value:"all"},{title:"待发货",value:"deliver_pending"},{title:"已发货",value:"delivered"},{title:"已核销",value:"offline_used"},{title:"退款中",value:"close_pending"},{title:"标记的",value:"marked"}]}},watch:{form:{handler:function(t,e){var i=this;this.$http.post("/export/order-total",this.form).then((function(t){i.itemTotal=t.data.total}))},deep:!0}},mounted:function(){var t=this;this.$http.post("/export/order-total",this.form).then((function(e){t.itemTotal=e.data.total}))},methods:{handleChange:function(t){t.file,t.fileList},handleOk:function(){Object(_["a"])(P({},this.form)).then((function(t){var e=window.open();e.location=Object({NODE_ENV:"production",BASE_URL:"/"}).VUE_APP_BASE_URL+"".concat(t.data.url)})).finally((function(){}))},handleCancel:function(){this.$emit("hide")}}},F=E,T=(i("a02e"),Object(d["a"])(F,S,$,!1,null,"38cb989c",null)),A=T.exports,U=function(){var t=this,e=t._self._c;return e("a-modal",{staticStyle:{top:"100px"},attrs:{title:"订单售后详情",visible:t.isShow,width:"800px",footer:!1},on:{ok:t.handleOk,cancel:t.handleCancel}},[e("div",{staticClass:"item"},[e("div",{staticClass:"key"},[t._v("订单ID:")]),e("div",{staticClass:"value"},[t._v(t._s(t.order.id))])]),e("div",{staticClass:"item"},[e("div",{staticClass:"key"},[t._v("订单编号:")]),e("div",{staticClass:"value"},[t._v(t._s(t.order.number))])]),e("div",{staticClass:"item"},[e("div",{staticClass:"key"},[t._v("订单状态:")]),e("div",{staticClass:"value"},[t._v(t._s(t.order.union_status_text))])]),e("div",{staticClass:"item"},[e("div",{staticClass:"key"},[t._v("售后发起时间:")]),e("div",{staticClass:"value"},[t._v(t._s(t.info.created_at))])]),e("div",{staticClass:"item"},[e("div",{staticClass:"key"},[t._v("售后原因:")]),e("div",{staticClass:"value"},[t._v(t._s(t.info.reason))])]),e("div",{staticClass:"item"},[e("div",{staticClass:"key"},[t._v("售后描述:")]),e("div",{staticClass:"value"},[t._v(t._s(t.info.desc))])]),e("div",{staticClass:"item"},[e("div",{staticClass:"key"},[t._v("是否收到货:")]),e("div",{staticClass:"value"},[1===t.info.deliver_status?[t._v("未收到货")]:[t._v("已收到货")]],2)]),e("div",{staticClass:"item"},[e("div",{staticClass:"key"},[t._v("图片凭证:")]),e("div",{staticClass:"value"},[t.info.images&&t.info.images.length?t._l(t.info.images,(function(t,i){return e("a",{attrs:{href:t,target:"_blank"}},[e("img",{staticClass:"aftersale-image",attrs:{src:t}})])})):e("span",[t._v(" / ")])],2)]),e("div",{staticClass:"item"},[e("div",{staticClass:"key"},[t._v("售后状态:")]),e("div",{staticClass:"value"},[e("a-tag",{attrs:{color:t.colorMap[t.info.union_status]}},[t._v(t._s(t.info.union_status_text))])],1)]),t.info.audited_at?e("div",{staticClass:"item"},[e("div",{staticClass:"key"},[t._v("审核时间:")]),e("div",{staticClass:"value"},[t._v("\n      "+t._s(t.info.audited_at||"-")+"\n    ")])]):t._e(),e("div",{staticClass:"item"},[e("div",{staticClass:"key"},[t._v("审核备注:")]),e("div",{staticClass:"value"},[t._v("\n      "+t._s(t.info.audit_remark||"-")+"\n    ")])]),t.info.sendback_at?e("div",{staticClass:"item"},[e("div",{staticClass:"key"},[t._v("寄回时间:")]),e("div",{staticClass:"value"},[t._v("\n      "+t._s(t.info.sendback_at||"-")+"\n    ")])]):t._e(),t.info.sendback_info?e("div",{staticClass:"item"},[e("div",{staticClass:"key"},[t._v("寄回物流:")]),e("div",{staticClass:"value"},[t._v("\n      "+t._s(t.info.sendback_info.express_name||"-")+"\n    ")])]):t._e(),t.info.sendback_info?e("div",{staticClass:"item"},[e("div",{staticClass:"key"},[t._v("寄回单号:")]),e("div",{staticClass:"value"},[t._v("\n      "+t._s(t.info.sendback_info.express_number||"-")+"\n    ")])]):t._e(),t.info.completed_at?e("div",{staticClass:"item"},[e("div",{staticClass:"key"},[t._v("完成时间:")]),e("div",{staticClass:"value"},[t._v("\n      "+t._s(t.info.completed_at||"-")+"\n    ")])]):t._e(),e("div",{staticClass:"btn-c"},[e("a-button",{staticStyle:{"margin-left":"30px"},attrs:{type:"primary"},on:{click:function(e){return t.initData()}}},[e("span",[t._v("刷新")])]),"completed"!==t.info.union_status?e("a-button",{staticStyle:{"margin-right":"10px",float:"right"},attrs:{type:"danger"},on:{click:function(e){return t.reject()}}},[e("span",[t._v("关闭售后")])]):t._e(),"audit_pending"===t.info.union_status?[1===t.info.deliver_status?e("a-button",{staticStyle:{"margin-right":"10px",float:"right"},attrs:{type:"primary"},on:{click:function(e){return t.acceptAftersale()}}},[e("span",[t._v("同意仅退款")])]):t._e(),2===t.info.deliver_status?e("a-button",{staticStyle:{"margin-right":"10px",float:"right"},attrs:{type:"primary"},on:{click:function(e){return t.acceptOnlyRefund()}}},[e("span",[t._v("同意退货退款")])]):t._e()]:t._e(),"sendback_received_pending"===t.info.union_status?[e("a-button",{staticStyle:{"margin-right":"10px",float:"right"},attrs:{type:"primary"},on:{click:function(e){return t.acceptComplete()}}},[e("span",[t._v("完成售后")])])]:t._e()],2)])},B=[];function z(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,a)}return i}function L(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?z(Object(i),!0).forEach((function(e){Object(r["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):z(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var I={components:{},props:{order:{type:Object},isShow:{type:Boolean}},computed:{uuid:function(){return this.order.aftersale&&this.order.aftersale.uuid}},data:function(){return{info:{},colorMap:{audit_rejected:"red",completed:"green"}}},watch:{uuid:function(){this.initData()}},mounted:function(){this.initData()},methods:{initData:function(){var t=this;this.$http("/aftersales/"+this.uuid).then((function(e){t.info=e.data.info}))},handleOk:function(){},handleCancel:function(){this.$emit("hide")},acceptOnlyRefund:function(){var t=this;this.$iForm.show({title:"确认同意仅退款吗？",labelWidth:"50px",frame:[{title:"操作说明",type:"text",text:'<span style="color:red">此操作不会自动退款</span>，同意后将标记为已完成售后。 <br/>同意后需单独对订单进行“退款并关闭”操作'},{title:"审核备注",type:"textarea",tips:"此说明会展示在用户前端中",key:"remark",span:22}],success:function(e){t.$http.put("/aftersales/"+t.uuid,L({type:"accept"},e)).then((function(e){t.initData(),t.$message.success("操作成功"),t.$iForm.hide(),t.$emit("refresh")}))}})},acceptAftersale:function(){var t=this;this.$iForm.show({title:"确认同意退货退款吗？",labelWidth:"50px",frame:[{title:"操作说明",type:"text",text:"同意后，用户需退回收到的货物并填写寄回快递信息"},{title:"审核备注",type:"textarea",tips:"此说明会展示在用户前端中",key:"remark",span:22}],success:function(e){t.$http.put("/aftersales/"+t.uuid,L({type:"accept"},e)).then((function(e){t.initData(),t.$message.success("操作成功"),t.$iForm.hide(),t.$emit("refresh")}))}})},acceptComplete:function(){var t=this;this.$iForm.show({title:"确认标记为已完成吗？",labelWidth:"50px",frame:[{title:"操作说明",type:"text",text:'<span style="color:red">此操作不会自动退款</span> <br/>标记后需单独对订单进行“退款并关闭”操作'}],success:function(e){t.$http.put("/aftersales/"+t.uuid,L({type:"complete"},e)).then((function(e){t.initData(),t.$message.success("操作成功"),t.$iForm.hide(),t.$emit("refresh")}))}})}},reject:function(){var t=this;this.$iForm.show({title:"填写拒绝售后的原因",labelWidth:"50px",frame:[{title:"原因",type:"textarea",tips:"此说明会展示在用户前端中",key:"remark",span:22}],success:function(e){t.$http.put("/aftersales/"+t.uuid,L({type:"reject"},e)).then((function(e){t.initData(),t.$message.success("操作成功"),t.$iForm.hide(),t.$emit("refresh")}))}})}},H=I,M=(i("6f0f"),Object(d["a"])(H,U,B,!1,null,"4b1d769b",null)),R=M.exports,W=i("e37f");function Y(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,a)}return i}function q(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Y(Object(i),!0).forEach((function(e){Object(r["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Y(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var N={name:"OrderList",components:{OrderItem:h,BatchDeliver:O,ExportPopup:A,AftersalePopup:R,IDatePicker:W["a"]},props:{},data:function(){return{isBatchDeliver:!1,isAftersale:!1,isFilter:!1,isDownload:!1,miniappType:"",orderType:"package",isExport:!1,filter:{start_at:"",end_at:""},statusList:[{text:"待发货",key:"deliver_pending"},{text:"已发货",key:"delivered"},{text:"已完成",key:"completed"},{text:"全部",key:"all"}],list:[],key:"",status:"deliver_pending",orderStat:{},itemTotal:0,page:1,perPage:6,current:{},expressList:[]}},created:function(){var t=this;this.refresh(),Object(_["b"])().then((function(e){t.expressList=e.data.list}))},watch:{status:function(){this.refresh()},orderType:function(){this.refresh()},key:function(){this.refresh()},page:function(){this.fetchData(),this.fetchStatData()},perPage:function(){this.fetchData(),this.fetchStatData()}},methods:{pageChange:function(t){this.page=t},onShowSizeChange:function(t,e){this.page=1,this.perPage=e},refresh:function(){this.page=1,this.fetchData(),this.fetchStatData()},fresh:function(){this.fetchData(),this.fetchStatData()},fetchStatData:function(){var t=this;this.$http.get("/user-level-prizes-state/total",{params:{key:this.key,type:this.orderType,created_at_start:this.filter.start_at,created_at_end:this.filter.end_at,money_price_min:this.filter.money_price_min?100*this.filter.money_price_min:"",money_price_max:this.filter.money_price_max?100*this.filter.money_price_max:""}}).then((function(e){t.orderStat=e.data.info}))},fetchData:function(){var t=this;this.$http.get("/user-level-prizes",{params:{per_page:this.perPage,page:this.page,status:this.status,type:this.orderType,key:this.key,created_at_start:this.filter.start_at,created_at_end:this.filter.end_at,money_price_min:this.filter.money_price_min?100*this.filter.money_price_min:"",money_price_max:this.filter.money_price_max?100*this.filter.money_price_max:""}}).then((function(e){t.list=e.data.list,t.itemTotal=e.data.item_total,console.log(t.list)}))},deliver:function(){var t=this;this.$iForm.show({frame:[{title:"发货方式",type:"radio",key:"express_type",span:24,default:"express",options:[{title:"普通物流快递",value:"express"},{title:"无需物流",value:"other"}]},{title:"快递公司",type:"select",key:"express_name",newline:!0,options:this.expressList,where:{express_type:"express"}},{title:"快递单号",newline:!0,key:"express_number",placeholder:"快递单号",where:{express_type:"express"}}],success:function(e){if(console.log(e),"express"==e.express_type){if(!e.express_number)return t.$message.warn("请填写单号"),!1;if(!e.express_name)return t.$message.warn("请选择快递公司"),!1}t.$http({url:"/user-level-prizes/".concat(t.current.uuid),method:"PATCH",data:q({type:"deliver"},e)}).then((function(e){t.fetchData(),t.fetchStatData(),t.$message.success("发货成功"),t.$iForm.hide()}))}})},batchDeliverSuccess:function(){this.refresh(),this.isBatchDeliver=!1},handleActions:function(t,e){var i=this;switch(this.current=this.list[e],t){case"订单发货":this.deliver();break;case"查看售后":this.isAftersale=1;break;case"同意退款":this.$iForm.show({title:"同意退款(请确认退款金额)",frame:[{type:"price",key:"money",title:"退款金额(人民币)",default:this.current.pay_money_price,tips:"请不要超出"+this.current.pay_money_price/100+"元，超出订单支付金额会造成退款失败"},{type:"text",text:this.current.pay_score_price,title:"退款金额(积分)",default:1e3}],success:function(t){i.$http({url:"/orders/".concat(i.current.uuid),method:"PATCH",data:q({type:"close_and_refund"},t)}).then((function(t){i.$message.success("退款成功"),i.$iForm.hide(),i.fetchData(),i.fetchStatData()}))}});break;case"部分退款":return this.$message.warn("部分退款功能维护中~"),!1;case"退款并关闭":this.$iForm.show({title:"退款并关闭订单",frame:[{type:"price",key:"refund_money",title:"原路退款",default:this.current.pay_money_price,tips:"原路退回指退回用户银行卡或微信钱包 <br/>金额不能超出当前订单实付金额("+this.current.pay_money_price/100+"元)"},{type:"price",key:"refund_balance",title:"退回余额",default:0,tips:"实时退回用户帐户余额, 可作为补偿部分填写"},{type:"text",text:this.current.redpack_discount/100+"元",key:"refund_score",title:"红包抵扣退款",tips:"此为用户使用的红包抵扣的退款",default:1e3},{type:"text",text:this.current.pay_score_price+this.current.score_used,key:"refund_score",title:"积分退款",tips:"此为用户使用的支付或抵扣的积分的退款",default:1e3}],success:function(t){if(t.refund_money>i.current.pay_money_price)return i.$message.error("原路退回金额不能超订单实付人民币金额~"),!1;i.$http({url:"/orders/".concat(i.current.uuid),method:"PATCH",data:q({type:"close_and_refund"},t)}).then((function(t){i.$message.success("退款成功"),i.$iForm.hide(),i.fetchData(),i.fetchStatData()}))}});break;case"取消退款":this.$confirm({title:"确认取消退款",content:"取消退款后订单将变为申请退款前的状态",onOk:function(){i.$http({url:"/orders/".concat(i.current.uuid),method:"PATCH",data:{type:"cancel_refund"}}).then((function(t){i.$message.success("关闭成功"),i.fetchData(),i.fetchStatData()}))}});break;case"撤回物品仓库":this.$confirm({title:"确认撤回到物品仓库",content:"撤回后订单将关闭并退回运费（如果有）。订单内物品会回到用户仓库中待用户回收或再次发货, 请谨慎操作!",onOk:function(){i.$http({url:"/orders/".concat(i.current.uuid),method:"PATCH",data:{type:"reset_to_package"}}).then((function(t){i.$message.success("撤回成功"),i.fetchData(),i.fetchStatData()}))}});break}},handleMark:function(t){var e=this;this.current=this.list[t];var i=this.current.marked_at?"unmark":"mark";this.$http({url:"/orders/"+this.current.uuid,method:"PATCH",data:{type:i}}).then((function(t){e.refresh(),e.$message.success("操作成功")}))},handleSetRemark:function(t){var e=this;this.current=this.list[t],this.$iForm.show({frame:[{title:"商家备注",type:"textarea",tips:"此备注仅显示在管理后台，用户无法看到",key:"remark",span:24,default:this.current.seller_remark}],success:function(t){Object(_["e"])(e.current.uuid,t.remark).then((function(t){e.fetchData(),e.$message.success("更新成功"),e.$iForm.hide()}))}})},handleSetAddress:function(t){var e=this;this.current=this.list[t];var i=this.current.address||{};this.$iForm.show({title:"更改收货地址",frame:[{title:"收件人",type:"input",key:"consignee",span:24,default:i.consignee},{title:"手机号",type:"input",key:"phone",span:24,default:i.phone},{title:"所在地区",type:"address",key:"area",span:24,default:[i.province,i.city,i.district]},{title:"详细地址",type:"textarea",key:"address",span:24,default:i.address}],success:function(t){Object(_["d"])(e.current.uuid,{province:t.area[0],city:t.area[1],district:t.area[2],address:t.address,consignee:t.consignee,phone:t.phone}).then((function(t){e.refresh(),e.$message.success("更新成功"),e.$iForm.hide()}))}})},handleEditDeliverInfo:function(t){var e=this;this.current=this.list[t];var i=this.current.deliver_record||{};this.$iForm.show({form:i,frame:[{title:"发货方式",type:"radio",key:"type",span:24,default:"express",options:[{title:"普通物流快递",value:"express"},{title:"无需物流",value:"other"}]},{title:"快递公司",type:"select",key:"express_name",newline:!0,options:this.expressList,where:{type:"express"}},{title:"快递单号",newline:!0,key:"express_number",placeholder:"快递单号",where:{type:"express"}},{title:"发货说明",newline:!0,key:"remark",placeholder:"说明(选填)",tips:"此说明会显示在用户前端"}],success:function(t){if("express"==t.type){if(!t.express_number)return e.$message.warn("请填写单号"),!1;if(!t.express_name)return e.$message.warn("请选择快递公司"),!1}e.$http.put("/orders/".concat(e.current.uuid),{type:"update_deliver_info",deliver_info:t}).then((function(t){e.fetchData(),e.fetchStatData(),e.$message.success("发货成功"),e.$iForm.hide()}))}})}}},V=N,J=(i("4ac7"),Object(d["a"])(V,a,s,!1,null,null,null));e["default"]=J.exports},"819e":function(t,e,i){"use strict";i("c74f")},8563:function(t,e,i){},"9eb3":function(t,e,i){},a02e:function(t,e,i){"use strict";i("ef00")},b0a5:function(t,e,i){"use strict";var a=i("b6c9");e["a"]=a["a"]},b30f:function(t,e,i){"use strict";i.d(e,"c",(function(){return r})),i.d(e,"e",(function(){return n})),i.d(e,"d",(function(){return o})),i.d(e,"a",(function(){return c})),i.d(e,"b",(function(){return l}));var a=i("b775"),s="/orders";function r(t,e){return Object(a["b"])({url:"".concat(s,"/").concat(t),method:"patch",data:{type:"deliver",deliver_info:e}})}function n(t,e){return Object(a["b"])({url:"".concat(s,"/").concat(t),method:"patch",data:{type:"update_seller_remark",seller_remark:e}})}function o(t,e){return Object(a["b"])({url:"".concat(s,"/").concat(t),method:"patch",data:{type:"update_address",address:e}})}function c(t){return Object(a["b"])({url:"/export/orders",method:"post",data:t})}function l(){return Object(a["b"])({url:"/express-list",method:"get"})}},c74f:function(t,e,i){},ef00:function(t,e,i){},f006:function(t,e,i){}}]);