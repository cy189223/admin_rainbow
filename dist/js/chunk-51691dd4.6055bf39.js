(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-51691dd4"],{"1cc0":function(t,e,i){"use strict";i("3af8")},2266:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"list"},[e("div",{staticClass:"content-head",staticStyle:{"margin-bottom":"20px"}},[e("div",{staticClass:"sort-keys"},[e("div",{staticClass:"tab-list"},t._l(t.statusList,(function(i,n){return e("div",{staticClass:"item",class:{actived:t.status===i.key},on:{click:function(e){t.status=i.key}}},[t._v("\n             "+t._s(i.text)+"\n             ("+t._s(t.statusTotal[i.key])+")\n           ")])})),0),e("a-input-search",{staticStyle:{width:"180px","margin-right":"10px"},attrs:{placeholder:"输入关键字","enter-button":"",allowClear:"",size:t.size},on:{input:t.onSearch,search:t.onSearch},model:{value:t.key,callback:function(e){t.key=e},expression:"key"}}),e("router-link",{staticStyle:{margin:"0px 10px"},attrs:{to:"/activity/egg-lottery/setting"},on:{click:function(e){return t.handleDelete(t.row)}}},[t._v("扭蛋机配置")])],1),t.selectMode?t._e():e("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:t.handleCreate}},[t._v("创建"+t._s(t.resourceTypeText))])],1),e("a-table",{staticClass:"table",attrs:{rowKey:function(t){return t.uuid},dataSource:t.list,pagination:t.pagination,size:t.size}},[e("a-table-column",{attrs:{title:"标题",width:"180px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("div",{staticClass:"title-c"},[e("img",{staticClass:"thumb",attrs:{src:i.thumb}}),e("div",{staticClass:"right"},[e("div",{staticClass:"title"},[t._v(t._s(i.title))]),e("PriceDisplay",{attrs:{info:i}})],1)])]}}])}),e("a-table-column",{attrs:{title:"库存/销量",width:"110px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("div",{staticClass:"stock"},[t._v("库存: "+t._s(i.stock))]),e("div",{staticClass:"stock"},[t._v("销量: "+t._s(i.sales))])]}}])}),e("a-table-column",{attrs:{title:"奖品池",width:"120px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("div",[e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleEditSku(i)}}},[t._v("\n              "+t._s(i.skus_count)+" 种奖品\n            ")])]),e("div",[t._v(t._s(i.sku_stock)+"件库存")])]}}])}),t.selectMode?t._e():e("a-table-column",{attrs:{title:"排序",width:"100px"},scopedSlots:t._u([{key:"default",fn:function(i){return[t._v("\n          "+t._s(i.list_weight)+"\n          "),e("span",{staticStyle:{"margin-left":"10px"},on:{click:function(e){return t.handleEditListWeight(i)}}},[e("a",{attrs:{href:"javascript:;"}},[e("a-icon",{attrs:{type:"edit"}})],1)])]}}],null,!1,439616402)}),t.selectMode?t._e():e("a-table-column",{attrs:{title:"上/下架",width:"60px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("ISwitch",{attrs:{value:i.status,active:1,unactive:0},on:{change:function(e){return t.listedStatusChange(e,i)}}})]}}],null,!1,1077108743)}),e("a-table-column",{attrs:{title:"创建日期",width:"100px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[t._v(t._s(t.$tool.showShortTime(i.created_at)))])]}}])}),t.selectMode?t._e():e("a-table-column",{attrs:{title:"操作",width:"180px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.getPath(i)}}},[t._v("预览/路径")]),e("a-divider",{attrs:{type:"vertical"}}),e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleEdit(i)}}},[t._v("编辑")]),e("a-divider",{attrs:{type:"vertical"}}),e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleDelete(i)}}},[t._v("删除")])],1)]}}],null,!1,2471534683)})],1),e("a-modal",{staticStyle:{top:"100px"},attrs:{title:(t.editUuid?"编辑":"创建")+t.resourceTypeText,visible:t.isEdit,width:"1000px",footer:null},on:{cancel:function(e){t.isEdit=!1}}},[t.isEdit?e("Edit",{attrs:{uuid:t.editUuid},on:{cancel:function(e){t.isEdit=!1},success:t.fetchData}}):t._e()],1),t.isEditSkuList?e("EditSkuList",{attrs:{info:t.current},on:{refresh:t.fetchData,close:function(e){t.isEditSkuList=!1}}}):t._e()],1)},a=[],s=(i("8e6e"),i("ac6a"),i("456d"),i("ade3")),r=(i("c1df"),i("7cc6")),c=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[e("a-tabs",{attrs:{"default-active-key":"1"}},[e("a-tab-pane",{key:"1",attrs:{tab:"基础设置"}},[e("IForm",{staticClass:"form-container",attrs:{formFrame:t.frameBase,formData:t.form},on:{"update:formData":function(e){t.form=e},"update:form-data":function(e){t.form=e}}})],1),e("a-tab-pane",{key:"2",attrs:{tab:"页面装修","force-render":""}},[e("IForm",{staticClass:"form-container",attrs:{formFrame:t.frameUI,formData:t.form},on:{"update:formData":function(e){t.form=e},"update:form-data":function(e){t.form=e}}})],1)],1),e("div",{staticStyle:{display:"flex","justify-content":"flex-end"},attrs:{slot:"action"},slot:"action"},[e("a-button",{staticClass:"btn",on:{click:t.cancel}},[t._v("取消")]),e("a-button",{staticClass:"btn",attrs:{type:"primary"},on:{click:t.submit}},[t._v("提交")])],1)],1)},o=[],u=i("b0a5");function l(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function p(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?l(Object(i),!0).forEach((function(e){Object(s["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var f="egg-lotteries",d={components:{IForm:u["a"]},data:function(){return{form:{},categoryList:[]}},props:{uuid:{type:String}},computed:{categoryOptions:function(){return this.categoryList.map((function(t){return{title:t.title,value:t.id}}))},frameBase:function(){return[{title:"活动标题",key:"title",newline:!0,required:!0},{title:"副标题",key:"sub_title",placeholder:"例如: 直播中随机抽取10位幸运儿",newline:!0},{title:"封面",key:"thumb",type:"image",tips:"800*800",sizeLimit:200,isShowImageTips:!1,newline:!0,required:!0},{title:"开奖时3D蛋图/盒图",key:"image_3d",type:"image",isShowImageTips:!1,tips:"600*900 png",newline:!0},{type:"blank",newline:!0},{title:"价格",type:"mix_price",key_prefix:"",newline:!0},{title:"次数库存",type:"number",key:"stock",tips:"此处库存指参与次数库存（扭5次扣除5个库存）",newline:!0,required:!0},{title:"奖品设置",type:"text",text:"创建后在列表中设置奖品"},{title:"每个用户限制次数",key:"per_user_limit",type:"number",tips:"0或不填写为不限制。 例如2代表每个用户仅可扭2次"},{type:"blank",newline:!0},{title:"详情图",key:"detail_images",type:"images",isShowImageTips:!1,tips:"1000px宽度，高度不限，长图请切成多张小图上传",newline:!0}]},frameUI:function(){var t;return[{title:"机柜主题风格",key:"theme",type:"radio",default:1,tips:"当前仅默认主题可用",options:[{title:"默认主题",value:1}],newline:!0,required:!0},(t={title:"页面背景图",key:"bg_image",tips:"不上传则使用默认图",isShowImageTips:!1},Object(s["a"])(t,"tips","1000 * 2160，不上传则使用默认图"),Object(s["a"])(t,"type","image"),Object(s["a"])(t,"newline",!0),t),{title:"机柜图",key:"body_image",tips:"750*1200, 参考图片规范包中扭蛋机机身图, 不上传则使用默认",isShowImageTips:!1,type:"image",newline:!0},{title:"扭1次按钮",key:"btn_1",tips:"200*80, 参考图片规范包中对应图片, 不上传则使用默认",isShowImageTips:!1,type:"image",newline:!0},{title:"扭1次按钮（按下）",key:"btn_1_on",tips:"200*80, 参考图片规范包中对应图片, 不上传则使用默认",isShowImageTips:!1,type:"image",newline:!0},{title:"扭5次按钮",key:"btn_5",tips:"126*66, 参考图片规范包中对应图片, 不上传则使用默认",isShowImageTips:!1,type:"image",newline:!0},{title:"扭5次按钮（按下）",key:"btn_5_on",tips:"126*66, 参考图片规范包中对应图片, 不上传则使用默认",isShowImageTips:!1,type:"image",newline:!0},{title:"试一试按钮",key:"btn_try",tips:"126*66, 参考图片规范包中对应图片, 不上传则使用默认",isShowImageTips:!1,type:"image",newline:!0},{title:"试一试按钮（按下）",key:"btn_try_on",tips:"126*66, 参考图片规范包中对应图片, 不上传则使用默认",isShowImageTips:!1,type:"image",newline:!0}]}},created:function(){},mounted:function(){this.uuid=this.uuid||this.$route.params.uuid,this.initForm()},watch:{uuid:function(){this.initForm()}},methods:{initForm:function(){var t=this;this.uuid?this.$http("/".concat(f,"/").concat(this.uuid)).then((function(e){t.form=e.data.info})):this.form=p(p({},this.$initForm(this.frameBase)),this.$initForm(this.frameUI))},cancel:function(){this.uuid="",this.$emit("cancel")},create:function(){var t=this;this.$http.post("/".concat(f),p({type:this.type},this.form)).then((function(e){t.$message.success("创建成功"),t.$emit("success")}))},update:function(){var t=this;this.$http.patch("/".concat(f,"/").concat(this.uuid),{type:"update",attributes:this.form}).then((function(e){t.$message.success("更新成功"),t.$emit("success")}))},submit:function(){this.uuid?this.update():this.create()}}},h=d,y=(i("65d1"),i("2877")),m=Object(y["a"])(h,c,o,!1,null,"8341740c",null),b=m.exports,g=function(){var t=this,e=t._self._c;return e("a-modal",{staticStyle:{top:"100px"},attrs:{title:"编辑奖品",visible:!0,width:"1000px"},on:{cancel:t.handleCancel}},[e("div",{staticClass:"tips"},[t._v("\n    中奖奖品会发放到用户的盒柜仓库中\n  ")]),e("a-table",{staticClass:"product-table",attrs:{rowKey:function(t){return t.id},dataSource:t.list,bordered:"",pagination:!1,size:"small"}},[e("a-table-column",{attrs:{title:"序号",width:"20px"},scopedSlots:t._u([{key:"default",fn:function(i,n,a){return[e("div",[t._v(t._s(a+1))])]}}])}),e("a-table-column",{key:"thumb",attrs:{title:"图片",width:"120px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("div",{staticStyle:{display:"flex","align-items":"center"}},[e("img",{staticClass:"thumb",staticStyle:{"margin-right":"10px"},attrs:{src:i.thumb}}),e("div",[t._v("\n            "+t._s(i.title)+" "),e("br"),t._v("\n            "+t._s(i.number)+"\n          ")])])]}}])}),e("a-table-column",{key:"number",attrs:{title:"概率",width:"50px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("div",[t._v("\n          "+t._s(i.odds||"-")+" %\n          ")])]}}])}),e("a-table-column",{attrs:{title:"价值",width:"100px"},scopedSlots:t._u([{key:"default",fn:function(t){return[e("div",[e("PriceDisplay",{attrs:{info:t}})],1)]}}])}),e("a-table-column",{attrs:{title:"库存",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("div",[t._v("\n          "+t._s(i.stock)+"\n        ")])]}}])}),e("a-table-column",{attrs:{title:"销量",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("div",[t._v("\n          "+t._s(i.sales)+"\n        ")])]}}])}),e("a-table-column",{attrs:{title:"SKU类型",width:"120px"},scopedSlots:t._u([{key:"default",fn:function(t){return[e("ISkuType",{attrs:{info:t}})]}}])}),e("a-table-column",{attrs:{title:"操作",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleEdit(i)}}},[t._v("编辑")]),e("a-divider",{attrs:{type:"vertical"}}),e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleDelete(i)}}},[t._v("删除")])]}}])})],1),e("template",{slot:"footer"},[e("div",{staticClass:"btn-c"},[e("a-button",{staticClass:"add",attrs:{type:"primary"},on:{click:t.handleCreate}},[t._v("\n        新增一款\n      ")]),e("div",{staticStyle:{"flex-grow":"1"}}),e("a-button",{key:"back",on:{click:t.handleCancel}},[t._v("关闭")])],1)])],2)},_=[],v=i("7971"),k=i("c685");function w(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function S(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?w(Object(i),!0).forEach((function(e){Object(s["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):w(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var O={components:{UploadImages:v["a"],iSwitch:r["a"],ISkuType:k["a"]},props:{info:{type:Object,default:function(){return{}}}},data:function(){return{list:[],frame:[{title:"SKU类型",key:"sku_type",type:"radio",default:1,required:!0,span:24,options:[{title:"无绑定",value:1},{title:"绑定商城中的商品",value:2},{title:"平台虚拟资产",value:3}],tips:""},{title:"绑定商品",key:"product_id",type:"product_id",auto_fill_fields:{title:"title",thumb:"thumb",number:"number",money_price:"money_price",score_price:"score_price"},where:{sku_type:2}},{title:"绑定虚拟资产",key:"assets",type:"assets",where:{sku_type:3}},{title:"奖品名称",key:"title",required:!0,placeholder:'如"积分礼包1"'},{title:"编号",key:"number",placeholder:"可填写编号方便在订单中对应货物"},{title:"封面",key:"thumb",type:"image"},{title:"库存",key:"stock",type:"number",suffix:"",tips:"",newline:!0,required:!0},{title:"开奖概率",key:"odds",type:"number",suffix:"%",tips:"概率之和可不等于100%。此处为概率权重。<br/>比如160权重的奖品比80权重的奖品开出概率高1倍",newline:!0,required:!0},{title:"价值",key_prefix:"",type:"mix_price",tips:"价值用于返售时作为返售原价进行折扣计算",newline:!0,required:!0}]}},watch:{uuid:function(){this.initList()}},created:function(){this.initList()},methods:{initList:function(){var t=this;this.$http.get("/egg-lottery/skus",{params:{activity_id:this.info.id}}).then((function(e){t.list=e.data.list}))},handleCreate:function(){var t=this;this.$iForm.show({title:"新增活动奖品",frame:this.frame,success:function(e){t.$http.post("/egg-lottery/skus",S({activity_id:t.info.id},e)).then((function(e){t.initList(),t.$iForm.hide()}))}})},handleEdit:function(t){var e=this;this.$iForm.show({title:"编辑活动奖品",frame:this.frame,form:t,success:function(i){e.$http.put("/egg-lottery/skus/".concat(t.uuid),{type:"update",attributes:i}).then((function(t){e.initList(),e.$iForm.hide()}))}})},handleCancel:function(){this.$emit("refresh"),this.$emit("close")},handleSave:function(){this.$emit("refresh"),this.$emit("close")},handleDelete:function(t){var e=this;this.$confirm({title:"提示",content:"确认删除吗？",onOk:function(){e.$http.delete("/egg-lottery/skus/".concat(t.uuid)).then((function(t){e.$message.success("删除成功"),e.initList()}))}})}}},j=O,x=(i("c91c"),Object(y["a"])(j,g,_,!1,null,"63448c78",null)),D=x.exports;function $(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function C(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?$(Object(i),!0).forEach((function(e){Object(s["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):$(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var E="egg-lotteries",P="扭蛋机",T={components:{ISwitch:r["a"],Edit:b,EditSkuList:D},props:{selectMode:{type:Boolean},params:{type:Object},size:{type:String,default:"default"},type:{type:String,default:""}},data:function(){var t;return t={isEdit:!1,editUuid:"",current:{},isEditSkuLevel:!1,isEditSkuList:!1,currentSkuLevel:1,resourceTypeText:P,exportOptions:{status:"all",startTime:"",endTime:"",type:"normal"},status:"unexpired",list:[],page:1,per_page:10,total:0,key:"",category_id:void 0,statusList:[{text:"上架中",key:"on_stock"},{text:"已下架",key:"off_stock"},{text:"售罄",key:"sell_out"}]},Object(s["a"])(t,"status","on_stock"),Object(s["a"])(t,"statusTotal",{on_stock:0,off_stock:0,sell_out:0,marked:0}),t},watch:{params:function(){this.refreshData()},category_id:function(){this.refreshData()},type:function(){this.refreshData()},status:function(){this.page=1,this.refreshData()}},computed:{pagination:function(){var t=this;return{defaultPageSize:this.per_page,defaultCurrent:this.page,total:this.total,onChange:function(e){t.page=e.current,t.per_page=e.pageSize,t.fetchData()}}}},filters:{},created:function(){this.fetchData()},methods:{fetchTotalData:function(){var t=this;this.$http("/status-total/activity/egg-lottery").then((function(e){t.statusTotal=e.data.total}))},handleEditSku:function(t){this.current=t,this.isEditSkuList=!0},getPath:function(t){this.$getPathPopup.show({page:"/pages/eggLottery/detail",param:"uuid="+t.uuid})},handleDelete:function(t){var e=this;this.$confirm({title:"提示",content:"确认删除吗？",onOk:function(){e.$http.delete("/".concat(E,"/").concat(t.uuid)).then((function(t){e.fetchData()}))}})},updateItem:function(t,e){return this.$http.patch("/".concat(E,"/").concat(t.uuid),{type:"update",attributes:C({},e)})},listedStatusChange:function(t,e){var i=this;this.updateItem(e,{status:t}).then((function(t){i.fetchData()}))},handleEditSkuLevel:function(t){this.current=t,this.isEditSkuLevel=!0},handleEditListWeight:function(t){var e=this;this.$globalForm.show({title:"编辑排序",items:[{type:"number",key:"list_weight",title:"排序",default:t.list_weight,required:!0}],success:function(i){e.updateItem(t,C({},i)).then((function(t){e.$message.success("保存成功"),e.$globalForm.hide(),e.fetchData()}))}})},handleCreate:function(){this.editUuid="",this.isEdit=!0},handleEdit:function(t){this.editUuid=t.uuid,this.isEdit=!0},refreshData:function(){this.page=1,this.key="",this.fetchData()},onSearch:function(t){this.page=1,this.fetchData()},fetchData:function(){var t=this;this.isEdit=!1,this.$http.get("/".concat(E),{params:C(C({status:this.status},this.params),{},{page:this.page,per_page:this.per_page,key:this.key,category_id:this.category_id})}).then((function(e){t.list=e.data.list,t.total=e.data.item_total})).finally((function(){t.fetchTotalData(),t.loading=!1}))},getCategoryList:function(){var t=this;this.$api.emit("category.list","article").then((function(e){t.category=e.data.list}))}}},I=T,L=(i("1cc0"),Object(y["a"])(I,n,a,!1,null,"675f20fb",null));e["default"]=L.exports},"256f":function(t,e,i){},"3af8":function(t,e,i){},"65d1":function(t,e,i){"use strict";i("256f")},"7a69":function(t,e,i){},b0a5:function(t,e,i){"use strict";var n=i("b6c9");e["a"]=n["a"]},c685:function(t,e,i){"use strict";var n=function(){var t=this,e=t._self._c;return e("div",[1===t.info.sku_type?e("span",[t._v("-")]):2===t.info.sku_type?e("div",[t._v("\n    商城商品\n    "),t.info.product?e("div",[t._v("\n      【"+t._s(t.info.product.title)+"】\n    ")]):t._e()]):3===t.info.sku_type?e("span",[t._v("虚拟资产")]):t._e()])},a=[],s={name:"ISwitch",props:{info:{type:Object,default:function(){return{}}}},data:function(){return{}},watch:{},methods:{}},r=s,c=i("2877"),o=Object(c["a"])(r,n,a,!1,null,"c7676646",null);e["a"]=o.exports},c91c:function(t,e,i){"use strict";i("7a69")}}]);