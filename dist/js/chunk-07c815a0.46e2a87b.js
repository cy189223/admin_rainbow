(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-07c815a0"],{"1f7f":function(t,e,i){},6721:function(t,e,i){"use strict";i.r(e);i("ac6a");var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"list"},[e("div",{staticClass:"content-head",staticStyle:{"margin-bottom":"20px"}},[e("div",{staticClass:"sort-keys"},[e("div",{staticClass:"tab-list"},t._l(t.statusList,(function(i,a){return e("div",{staticClass:"item",class:{actived:t.keys.status===i.key},on:{click:function(e){t.keys.status=i.key}}},[t._v("\n            "+t._s(i.text)+"\n            ("+t._s(t.statusTotal[i.key])+")\n          ")])})),0),e("a-input-search",{staticStyle:{width:"180px","margin-right":"10px"},attrs:{placeholder:"输入关键字","enter-button":"",allowClear:"",size:t.size},on:{input:t.onSearch,search:t.onSearch},model:{value:t.key,callback:function(e){t.key=e},expression:"key"}}),e("router-link",{staticStyle:{margin:"0px 10px"},attrs:{to:"/box/setting"},on:{click:function(e){return t.handleDelete(t.row)}}},[t._v("盲盒全局配置")])],1),t.selectMode?t._e():e("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:t.handleCreate}},[t._v("创建"+t._s(t.resourceTypeText))])],1),e("a-table",{staticClass:"table",attrs:{rowKey:function(t){return t.uuid},dataSource:t.list,pagination:t.pagination,size:t.size}},[e("a-table-column",{staticClass:"table-column",attrs:{title:"标题",width:"300px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("div",{staticClass:"thumb-c"},[e("img",{staticClass:"thumb",attrs:{src:i.thumb+"?x-oss-process=image/resize,w_400"}}),e("div",{staticClass:"right"},[e("div",{staticClass:"title"},[t._v("\n                "+t._s(i.title)+"\n                "),e("div",[i.is_presell?e("a-tag",{staticClass:"small",attrs:{color:"orange"}},[t._v("预售")]):t._e(),0==i.status?e("a-tag",{staticClass:"small",attrs:{color:"red",size:"small"}},[t._v("下架")]):t._e()],1)]),e("div",{staticClass:"image-tag"},[e("span",{staticClass:"marked-tag",class:{actived:i.marked_at},on:{click:function(e){return t.markBox(i)}}},[t._v("标记")]),e("span",[t._v("角标:")]),e("span",[t._v(t._s(i.image_tag&&i.image_tag.title||"-"))])]),e("div",{staticClass:"price"},[e("PriceDisplay",{attrs:{info:i}})],1)])])]}}])}),e("a-table-column",{attrs:{title:"SKU",width:"280px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("div",[e("span",{staticStyle:{"font-weight":"500"}},[t._v("普通款: ")]),e("span",[t._v(t._s(i.normal_skus_count)+"款")]),t._v(" \n            "),e("span",[t._v(t._s(i.normal_sku_sales||0)+"销量")]),t._v(" \n            "),e("span",[t._v(t._s(i.normal_sku_stock||0)+"库存")]),t._v(" \n            "),e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleEditNormalSku(i)}}},[t._v("编辑")])]),e("div",{staticStyle:{"margin-top":"4px"}},[e("span",{staticStyle:{"font-weight":"500"}},[t._v("隐藏款: ")]),e("span",[t._v(t._s(i.hidden_skus_count)+"款")]),t._v(" \n            "),e("span",[t._v(t._s(i.hidden_sku_sales||0)+"销量")]),t._v(" \n            "),e("span",[t._v(t._s(i.hidden_sku_stock||0)+"库存")]),t._v(" \n            "),e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleEditHiddenSku(i)}}},[t._v("编辑")])])]}}])}),e("a-table-column",{attrs:{title:"统计",width:"120px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("div",[t._v(t._s(i.room_total)+"房间")]),e("div",[t._v(t._s(i.sales)+"销量")]),e("div",[t._v(t._s(i.return_total)+"返售")])]}}])}),e("a-table-column",{attrs:{title:"上下架",width:"40px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("ISwitch",{attrs:{value:i.status,active:1,unactive:0},on:{change:function(e){return t.statusChange(e,i)}}})]}}])}),e("a-table-column",{attrs:{title:"权重",width:"120px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[t._v(t._s(i.list_weight))]),t._v("  \n          "),e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleEditListWeight(i)}}},[t._v("编辑")])]}}])}),e("a-table-column",{key:"action",attrs:{title:"操作",width:"220px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("div",[e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.getPath(i)}}},[t._v("预览/路径")]),e("a-divider",{attrs:{type:"vertical"}}),e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleEdit(i)}}},[t._v("编辑")])],1),e("div",{staticStyle:{"margin-top":"6px"}},[e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleCopy(i)}}},[t._v("复制")]),e("a-divider",{attrs:{type:"vertical"}}),e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleDelete(i)}}},[t._v("删除")])],1)]}}])})],1),t.isEditNormalSku?e("EditNormalSku",{attrs:{uuid:t.editUuid},on:{refresh:t.fetchData,close:function(e){t.isEditNormalSku=!1}}}):t._e(),e("a-modal",{staticStyle:{top:"100px"},attrs:{title:(t.editUuid?"编辑":"创建")+t.resourceTypeText,maskClosable:!1,visible:t.isEdit,width:"1000px",footer:null},on:{cancel:function(e){t.isEdit=!1}}},[t.isEdit?e("EditForm",{attrs:{uuid:t.editUuid},on:{cancel:function(e){t.isEdit=!1},success:t.fetchData}}):t._e()],1),e("a-modal",{attrs:{title:"编辑隐藏款",width:"1480px",footer:null,visible:t.isEditHiddenSku},on:{cancel:function(e){t.isEditHiddenSku=t.fetchData()||!1}}},[e("div",[e("EditHiddenSku",{attrs:{uuid:t.editUuid},on:{close:function(e){t.isEditHiddenSku=!1},refresh:t.fetchData}})],1)])],1)},s=[],n=(i("8e6e"),i("456d"),i("ade3")),l=(i("c1df"),i("7cc6")),o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"editor-content"},[t._m(0),e("a-table",{staticClass:"product-table",attrs:{rowKey:function(t){return t.uuid},dataSource:t.list,bordered:"",pagination:!1,size:"small"}},[e("a-table-column",{attrs:{title:"序号",width:"50px"},scopedSlots:t._u([{key:"default",fn:function(i,a,s){return[e("div",[t._v(t._s(s+1))])]}}])}),e("a-table-column",{attrs:{title:"图片",width:"140px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("UploadImages",{attrs:{tips:"600*800",size:"small"},model:{value:i.thumb,callback:function(e){t.$set(i,"thumb",e)},expression:"row.thumb"}})]}}])}),e("a-table-column",{key:"title",attrs:{title:"标题/编号",width:"220px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("div",{staticStyle:{"margin-top":"6px",display:"flex","align-items":"center"}},[e("div",{staticStyle:{flex:"0 0 36px"}},[t._v("标题")]),e("a-input",{staticStyle:{width:"180px"},attrs:{placeholder:"请输入"},model:{value:i.title,callback:function(e){t.$set(i,"title",e)},expression:"row.title"}})],1),e("div",{staticStyle:{"margin-top":"6px",display:"flex","align-items":"center"}},[e("div",{staticStyle:{flex:"0 0 36px"}},[t._v("编号")]),e("a-input",{attrs:{placeholder:"选填"},model:{value:i.number,callback:function(e){t.$set(i,"number",e)},expression:"row.number"}})],1)]}}])}),e("a-table-column",{key:"title",attrs:{title:"奖品类型",width:"130px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("ISkuType",{attrs:{info:i}}),e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleEdit(i)}}},[t._v("编辑")])]}}])}),e("a-table-column",{attrs:{width:"160px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("div",[e("IPrice",{staticStyle:{width:"110px"},attrs:{size:"small",placeholder:"请输入"},model:{value:i.display_money_price,callback:function(e){t.$set(i,"display_money_price",e)},expression:"row.display_money_price"}}),t._v(" +\n        ")],1),e("div",{staticStyle:{"margin-top":"6px"}},[e("a-input",{staticStyle:{width:"90px"},attrs:{size:"small",placeholder:"请输入"},model:{value:i.display_score_price,callback:function(e){t.$set(i,"display_score_price",t._n(e))},expression:"row.display_score_price"}}),t._v(" 积分\n        ")],1)]}}])},[e("div",{attrs:{slot:"title"},slot:"title"},[t._v("\n        零售价\n        "),e("tips",[t._v("1、显示在小程序端")])],1)]),e("a-table-column",{attrs:{width:"160px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("div",[e("IPrice",{staticStyle:{width:"110px"},attrs:{size:"small",placeholder:"请输入"},model:{value:i.money_price,callback:function(e){t.$set(i,"money_price",e)},expression:"row.money_price"}}),t._v(" +\n       ")],1),e("div",{staticStyle:{"margin-top":"6px"}},[e("a-input",{staticStyle:{width:"90px"},attrs:{size:"small",placeholder:"请输入"},model:{value:i.score_price,callback:function(e){t.$set(i,"score_price",t._n(e))},expression:"row.score_price"}}),t._v(" 积分\n       ")],1)]}}])},[e("div",{attrs:{slot:"title"},slot:"title"},[t._v("\n       回收价\n       "),e("tips",[t._v("1、作为回收原价进行折扣计算")])],1)]),e("a-table-column",{attrs:{title:"库存",width:"100px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[e("a-input",{attrs:{placeholder:"库存"},model:{value:i.stock,callback:function(e){t.$set(i,"stock",e)},expression:"row.stock"}})],1)]}}])}),e("a-table-column",{attrs:{title:"已售",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[t._v("\n          "+t._s(i.sales)+"\n          ")])]}}])}),e("a-table-column",{attrs:{width:"160px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[t._v("\n          每抽"),e("a-input",{staticStyle:{width:"80px",margin:"0px 1px"},attrs:{placeholder:"0-100"},model:{value:i.probability,callback:function(e){t.$set(i,"probability",e)},expression:"row.probability"}}),t._v("次出1个\n        ")],1)]}}])},[e("div",{attrs:{slot:"title"},slot:"title"},[t._v("\n        概率\n        "),e("tips",[t._v("1、填0则不会出现隐藏款"),e("br"),t._v(" 2、一次连抽最多出1个隐藏 "),e("br"),t._v("  3、每段最后20%出隐藏。如填1000，则每段的第800-1000次随机出1个隐藏。")])],1)]),e("a-table-column",{attrs:{title:"允许回收",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(i){return[3===i.sku_type?e("span",[t._v("\n          系统禁止\n        ")]):e("span",[e("i-switch",{attrs:{active:i.is_return_saleable||1,size:"small"},model:{value:i.is_return_saleable,callback:function(e){t.$set(i,"is_return_saleable",e)},expression:"row.is_return_saleable"}})],1)]}}])}),e("a-table-column",{attrs:{title:"上下架",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[e("i-switch",{attrs:{active:i.status||1,size:"small"},model:{value:i.status,callback:function(e){t.$set(i,"status",e)},expression:"row.status"}})],1)]}}])}),e("a-table-column",{attrs:{title:"操作",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleDelete(i)}}},[t._v("删除")])]}}])})],1),e("div",{staticClass:"btn-c"},[e("a-button",{staticClass:"add",attrs:{type:"primary"},on:{click:t.handleCreate}},[t._v("\n      新增一款\n    ")]),e("div",{staticStyle:{"flex-grow":"1"}}),e("a-button",{staticClass:"save",attrs:{type:"primary"},on:{click:t.handleSave}},[t._v("保存")]),e("a-button",{staticClass:"cancel",on:{click:t.handleCancel}},[t._v("关闭")])],1)],1)},r=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"tips",staticStyle:{color:"red","font-size":"90%","margin-bottom":"10px"}},[t._v("\n    虚拟资产类奖品禁止回收\n    "),e("a",{attrs:{href:"https://www.yuque.com/u1307645/mwy3k3/xkcbir",target:"_blank"}},[t._v("回收说明文档")])])}],c=(i("20d6"),i("7971")),u=i("dd08"),p=i("8703");function d(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,a)}return i}function h(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?d(Object(i),!0).forEach((function(e){Object(n["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):d(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var f={components:{UploadImages:c["a"],iSwitch:l["a"],IPrice:u["a"],MixPrice:p["a"]},props:{uuid:{type:String,default:function(){return""}}},data:function(){return{list:[],frame:[{title:"奖品类型",key:"sku_type",type:"radio",default:1,required:!0,span:24,options:[{title:"无绑定",value:1},{title:"绑定商城中的商品",value:2},{title:"平台虚拟资产",value:3}],tips:""},{title:"绑定商品",key:"product_id",type:"product_id",auto_fill_fields:{title:"title",thumb:"thumb",number:"number",money_price:"money_price",score_price:"score_price"},where:{sku_type:2}},{title:"绑定虚拟资产",key:"assets",type:"assets",where:{sku_type:3}},{title:"奖品名称",key:"title",required:!0,placeholder:'如"积分礼包1"'},{title:"编号",key:"number",placeholder:"可填写编号方便在订单中对应货物"},{title:"封面",key:"thumb",type:"image"},{title:"奖品详情图",key:"detail_images",type:"images",newline:!0,sizeLimit:400,tips:"显示在用户的物品详情中。 不上传则不显示。 <br/> 长图请切成多张小图上传"}]}},watch:{uuid:function(){this.initList()}},created:function(){this.initList()},methods:{handleEdit:function(t){var e=this;this.$iForm.show({title:"编辑活动奖品",frame:this.frame,form:t,success:function(i){var a=e.list.findIndex((function(e){return e.uuid===t.uuid}));console.log(a),e.list.splice(a,1,h(h({},e.list[a]),i)),e.$iForm.hide()}})},initList:function(){var t=this;this.$http.get("/boxes/".concat(this.uuid,"/hidden-skus")).then((function(e){t.list=e.data.list}))},handleCreate:function(){var t=this;this.$http.post("/boxes/".concat(this.uuid,"/hidden-skus")).then((function(e){t.initList()}))},handleCancel:function(){this.$emit("refresh"),this.$emit("close")},handleSave:function(){var t=this;this.$http.put("/boxes/".concat(this.uuid,"/hidden-skus/batch"),{list:this.list}).then((function(e){t.$message.success("保存成功"),t.initList()}))},handleDelete:function(t){var e=this;this.$http.delete("/boxes/".concat(this.uuid,"/hidden-skus/").concat(t.uuid)).then((function(t){e.$message.success("删除成功"),e.initList()}))}}},m=f,_=(i("fb01"),i("2877")),y=Object(_["a"])(m,o,r,!1,null,"40245f01",null),v=y.exports,b=function(){var t=this,e=t._self._c;return e("a-modal",{staticStyle:{top:"100px"},attrs:{title:"编辑普通款",visible:!0,width:"1480px"},on:{cancel:t.handleCancel}},[e("div",{staticClass:"tips",staticStyle:{color:"red","font-size":"96%","margin-bottom":"10px"}},[t._v("\n    虚拟资产类奖品禁止回收\n    "),e("a",{attrs:{href:"https://www.yuque.com/u1307645/mwy3k3/xkcbir",target:"_blank"}},[t._v("回收说明文档")])]),e("a-table",{staticClass:"product-table",attrs:{rowKey:function(t){return t.id},dataSource:t.list,bordered:"",pagination:!1,size:"small"}},[e("a-table-column",{attrs:{title:"序号",width:"50px"},scopedSlots:t._u([{key:"default",fn:function(i,a,s){return[e("div",[t._v(t._s(s+1))])]}}])}),e("a-table-column",{attrs:{title:"图片",width:"130px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("UploadImages",{attrs:{tips:"600*800",size:"small"},model:{value:i.thumb,callback:function(e){t.$set(i,"thumb",e)},expression:"row.thumb"}})]}}])}),e("a-table-column",{attrs:{title:"标题/编号",width:"220px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("div",{staticStyle:{"margin-top":"6px",display:"flex","align-items":"center"}},[e("div",{staticStyle:{flex:"0 0 36px"}},[t._v("标题")]),e("a-input",{staticStyle:{width:"180px"},attrs:{placeholder:"请输入"},model:{value:i.title,callback:function(e){t.$set(i,"title",e)},expression:"row.title"}})],1),e("div",{staticStyle:{"margin-top":"6px",display:"flex","align-items":"center"}},[e("div",{staticStyle:{flex:"0 0 36px"}},[t._v("编号")]),e("a-input",{attrs:{placeholder:"选填"},model:{value:i.number,callback:function(e){t.$set(i,"number",e)},expression:"row.number"}})],1)]}}])}),e("a-table-column",{attrs:{title:"奖品类型",width:"130px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("ISkuType",{attrs:{info:i}}),e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleEdit(i)}}},[t._v("编辑")])]}}])}),e("a-table-column",{attrs:{width:"160px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("div",[e("IPrice",{staticStyle:{width:"110px"},attrs:{size:"small",placeholder:"请输入"},model:{value:i.display_money_price,callback:function(e){t.$set(i,"display_money_price",e)},expression:"row.display_money_price"}}),t._v(" +\n        ")],1),e("div",{staticStyle:{"margin-top":"6px"}},[e("a-input",{staticStyle:{width:"90px"},attrs:{size:"small",placeholder:"请输入"},model:{value:i.display_score_price,callback:function(e){t.$set(i,"display_score_price",t._n(e))},expression:"row.display_score_price"}}),t._v(" 积分\n        ")],1)]}}])},[e("div",{attrs:{slot:"title"},slot:"title"},[t._v("\n        零售价\n        "),e("tips",[t._v("1、显示在小程序端")])],1)]),e("a-table-column",{attrs:{width:"160px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("div",[e("IPrice",{staticStyle:{width:"110px"},attrs:{size:"small",placeholder:"请输入"},model:{value:i.money_price,callback:function(e){t.$set(i,"money_price",e)},expression:"row.money_price"}}),t._v(" +\n        ")],1),e("div",{staticStyle:{"margin-top":"6px"}},[e("a-input",{staticStyle:{width:"90px"},attrs:{size:"small",placeholder:"请输入"},model:{value:i.score_price,callback:function(e){t.$set(i,"score_price",t._n(e))},expression:"row.score_price"}}),t._v(" 积分\n        ")],1)]}}])},[e("div",{attrs:{slot:"title"},slot:"title"},[t._v("\n        回收价\n        "),e("tips",[t._v("1、作为回收原价进行折扣计算")])],1)]),e("a-table-column",{attrs:{title:"库存",width:"90px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[e("a-input",{attrs:{placeholder:"请输入"},model:{value:i.stock,callback:function(e){t.$set(i,"stock",e)},expression:"row.stock"}})],1)]}}])}),e("a-table-column",{attrs:{width:"120px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[e("a-input",{staticStyle:{width:"70px",margin:"0px 1px"},attrs:{placeholder:"0-100"},model:{value:i.odds,callback:function(e){t.$set(i,"odds",e)},expression:"row.odds"}}),t._v("%\n        ")],1)]}}])},[e("div",{attrs:{slot:"title"},slot:"title"},[t._v("\n        抽中概率(%)\n        "),e("tips",[t._v("1、此概率在连抽情况或非1:1情况下生效 "),e("br"),t._v(" 2、此概率可设置显示在小程序端")])],1)]),e("a-table-column",{attrs:{title:"已售",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[t._v("\n          "+t._s(i.sales)+"次\n        ")])]}}])}),e("a-table-column",{attrs:{title:"允许回收",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(i){return[3===i.sku_type?e("span",[t._v("\n          系统禁止\n        ")]):e("span",[e("i-switch",{attrs:{active:i.is_return_saleable||1,size:"small"},model:{value:i.is_return_saleable,callback:function(e){t.$set(i,"is_return_saleable",e)},expression:"row.is_return_saleable"}})],1)]}}])}),e("a-table-column",{attrs:{title:"上下架",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[e("i-switch",{attrs:{active:i.status||1,size:"small"},model:{value:i.status,callback:function(e){t.$set(i,"status",e)},expression:"row.status"}})],1)]}}])}),e("a-table-column",{attrs:{title:"操作",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleDelete(i)}}},[t._v("删除")])]}}])})],1),e("template",{slot:"footer"},[e("div",{staticClass:"btn-c"},[e("a-button",{staticClass:"add",attrs:{type:"primary"},on:{click:t.handleCreate}},[t._v("\n        新增一款\n      ")]),e("div",{staticStyle:{"flex-grow":"1"}}),e("a-button",{key:"back",on:{click:t.handleCancel}},[t._v("取消")]),e("a-button",{key:"submit",attrs:{type:"primary"},on:{click:t.handleSave}},[t._v("\n        保存\n      ")])],1)])],2)},k=[],g=i("c685");function w(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,a)}return i}function x(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?w(Object(i),!0).forEach((function(e){Object(n["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):w(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var S={components:{UploadImages:c["a"],iSwitch:l["a"],IPrice:u["a"],ISkuType:g["a"]},props:{uuid:{type:String,default:function(){return""}}},data:function(){return{list:[],frame:[{title:"奖品类型",key:"sku_type",type:"radio",default:1,required:!0,span:24,options:[{title:"无绑定",value:1},{title:"绑定商城中的商品",value:2},{title:"平台虚拟资产",value:3}],tips:""},{title:"绑定商品",key:"product_id",type:"product_id",auto_fill_fields:{title:"title",thumb:"thumb",number:"number",money_price:"money_price",score_price:"score_price"},where:{sku_type:2}},{title:"绑定虚拟资产",key:"assets",type:"assets",where:{sku_type:3}},{title:"奖品名称",key:"title",required:!0,placeholder:'如"积分礼包1"'},{title:"编号",key:"number",placeholder:"可填写编号方便在订单中对应货物"},{title:"封面",key:"thumb",type:"image"},{title:"奖品详情图",key:"detail_images",type:"images",newline:!0,sizeLimit:400,tips:"显示在用户的物品详情中。 不上传则不显示。 <br/> 长图请切成多张小图上传"}]}},watch:{uuid:function(){this.initList()}},created:function(){this.initList()},methods:{handleEdit:function(t){var e=this;this.$iForm.show({title:"编辑活动奖品",frame:this.frame,form:t,success:function(i){var a=e.list.findIndex((function(e){return e.uuid===t.uuid}));console.log(a),e.list.splice(a,1,x(x({},e.list[a]),i)),e.$iForm.hide()}})},initList:function(){var t=this;this.$http.get("/boxes/".concat(this.uuid,"/normal-skus")).then((function(e){t.list=e.data.list}))},handleCreate:function(){var t=this;this.$http.post("/boxes/".concat(this.uuid,"/normal-skus")).then((function(e){t.initList()}))},handleCancel:function(){this.$emit("refresh"),this.$emit("close")},handleSave:function(){var t=this;this.$http.put("/boxes/".concat(this.uuid,"/normal-skus/batch"),{list:this.list}).then((function(e){t.$message.success("保存成功"),t.initList()}))},handleDelete:function(t){var e=this;this.$http.delete("/boxes/".concat(this.uuid,"/normal-skus/").concat(t.uuid)).then((function(t){e.$message.success("删除成功"),e.initList()}))}}},O=S,$=(i("832d"),Object(_["a"])(O,b,k,!1,null,"19a8d5e5",null)),C=$.exports,j=function(){var t=this,e=t._self._c;return e("div",{staticClass:"editor-content"},[t._m(0),e("a-table",{staticClass:"product-table",attrs:{rowKey:function(t){return t.uuid},dataSource:t.list,bordered:"",pagination:!1,size:"small"}},[e("a-table-column",{attrs:{title:"序号",width:"50px"},scopedSlots:t._u([{key:"default",fn:function(i,a,s){return[e("div",[t._v(t._s(s+1))])]}}])}),e("a-table-column",{attrs:{title:"图片",width:"100px"},scopedSlots:t._u([{key:"default",fn:function(t){return[e("img",{staticClass:"thumb",attrs:{src:t.thumb}})]}}])}),e("a-table-column",{attrs:{title:"标题",width:"160px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("div",{staticClass:"title"},[t._v("\n          "+t._s(i.title)+"\n        ")]),e("div",{staticClass:"number"},[t._v("\n          "+t._s(i.number)+"\n        ")])]}}])}),e("a-table-column",{attrs:{title:"兑换设置"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("div",[e("span",[t._v("集齐")]),e("a-input",{staticStyle:{width:"70px"},attrs:{placeholder:"整数"},model:{value:i.chip_need_sku_total,callback:function(e){t.$set(i,"chip_need_sku_total",e)},expression:"row.chip_need_sku_total"}}),e("span",[t._v("个此sku，兑换")]),e("a-input",{staticStyle:{width:"70px"},attrs:{placeholder:"整数"},model:{value:i.chip_total,callback:function(e){t.$set(i,"chip_total",e)},expression:"row.chip_total"}}),e("span",[t._v("个")]),e("a-select",{staticClass:"select",attrs:{placeholder:"请到碎片模块创建"},model:{value:i.chip_id,callback:function(e){t.$set(i,"chip_id",e)},expression:"row.chip_id"}},t._l(t.chipList,(function(i){return e("a-select-option",{attrs:{value:i.id}},[t._v(t._s(i.title))])})),1)],1)]}}])}),e("a-table-column",{attrs:{title:"兑换开关",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[e("i-switch",{attrs:{active:i.chip_status||1,size:"small"},model:{value:i.chip_status,callback:function(e){t.$set(i,"chip_status",e)},expression:"row.chip_status"}})],1)]}}])})],1),e("div",{staticClass:"btn-c"},[e("div",{staticStyle:{"flex-grow":"1"}}),e("a-button",{staticClass:"save",attrs:{type:"primary"},on:{click:t.handleSave}},[t._v("保存")]),e("a-button",{staticClass:"cancel",on:{click:t.handleCancel}},[t._v("关闭")])],1)],1)},D=[function(){var t=this,e=t._self._c;return e("div",{staticStyle:{color:"gray","font-size":"90%","margin-bottom":"10px"}},[t._v('\n    可单独对sku设置碎片兑换。 用户可在"我的盒柜"中把抽到的盲盒(未发货的)按设置的兑换率兑换成对应的碎片。\n    '),e("br"),t._v("\n    兑换后盲盒不再发货（与返售相似）。碎片可用于在商城中兑换商城商品（可在”商品管理“中对单个商品设置兑换率）。\n  ")])}],E={components:{UploadImages:c["a"],iSwitch:l["a"]},props:{uuid:{type:String,default:function(){return""}}},data:function(){return{list:[],chipList:[]}},watch:{uuid:function(){this.initList()}},created:function(){this.initList()},methods:{initList:function(){var t=this;this.$http.get("/boxes/".concat(this.uuid,"/skus")).then((function(e){t.list=e.data.list})),this.$http.get("/chips").then((function(e){t.chipList=e.data.list}))},handleCreate:function(){var t=this;this.$http.post("/boxes/".concat(this.uuid,"/skus")).then((function(e){t.initList()}))},handleCancel:function(){this.$emit("refresh"),this.$emit("close")},handleSave:function(){var t=this;this.$http.put("/boxes/".concat(this.uuid,"/skus/batch"),{list:this.list}).then((function(e){t.$message.success("保存成功"),t.initList()}))},handleDelete:function(t){var e=this;this.$http.delete("/boxes/".concat(this.uuid,"/skus/").concat(t.uuid)).then((function(t){e.$message.success("删除成功"),e.initList()}))}}},P=E,L=(i("ddb1"),Object(_["a"])(P,j,D,!1,null,"03b95ba3",null)),z=L.exports,I=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[e("a-tabs",{attrs:{"default-active-key":"1"}},[e("a-tab-pane",{key:"1",attrs:{tab:"基础设置"}},[e("IForm",{staticClass:"form-container",attrs:{formFrame:t.frameBase,formData:t.form},on:{"update:formData":function(e){t.form=e},"update:form-data":function(e){t.form=e}}})],1),e("a-tab-pane",{key:"2",attrs:{tab:"页面装修","force-render":""}},[e("IForm",{staticClass:"form-container",attrs:{formFrame:t.frameUI,formData:t.form},on:{"update:formData":function(e){t.form=e},"update:form-data":function(e){t.form=e}}})],1)],1),e("div",{staticStyle:{display:"flex","justify-content":"flex-end"},attrs:{slot:"action"},slot:"action"},[e("a-button",{staticClass:"btn",on:{click:t.cancel}},[t._v("取消")]),e("a-button",{staticClass:"btn",attrs:{type:"primary"},on:{click:t.submit}},[t._v("提交")])],1)],1)},T=[],F=i("b0a5");function U(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,a)}return i}function q(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?U(Object(i),!0).forEach((function(e){Object(n["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):U(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var H="boxes",N={components:{IForm:F["a"]},data:function(){return{form:{sku_ratio_type:1},categoryList:[],imageTagList:[]}},props:{uuid:{type:String}},computed:{categoryOptions:function(){return this.categoryList.map((function(t){return{title:t.title,value:t.id}}))},imageTagOptions:function(){return this.imageTagList.map((function(t){return{title:t.title,value:t.id}}))},frameBase:function(){return[{title:"标题",key:"title",newline:!0,required:!0},{title:"角标",key:"image_tag_id",type:"select",span:12,options:this.imageTagOptions},{title:"标签",key:"tags",type:"tags",tips:"会显示在盲盒列表封面图下方，建议填写。如“热卖新品”等短语",newline:!0,required:!0},{title:"所属IP",key:"category_ids",newline:!0,required:!0,type:"multi_select",options:this.categoryOptions},{title:"列表封面",key:"thumb",type:"image",sizeLimit:250,tips:"600*600",required:!0,newline:!0},{type:"blank"},{type:"blank",newline:!0},{title:"售价",key_prefix:"",type:"mix_price",newline:!0},{title:"每个房间小盒数",key:"sku_total",type:"radio",newline:!0,required:!0,disabled:!!this.uuid,default:9,tips:"创建后不可更改，请谨慎选择",options:[{title:4,value:4},{title:5,value:5},{title:6,value:6},{title:7,value:7},{title:8,value:8},{title:9,value:9},{title:10,value:10},{title:11,value:11},{title:12,value:12}]},{title:"单个房间中奖品模式",key:"sku_ratio_type",type:"radio",default:1,span:24,tips:'不允许重复时同一房间中奖品位置永久固定，允许重复则同一房间的奖品位置及种类每次不固定 <a target="_blank" href="https://www.yuque.com/u1307645/mwy3k3/mp3y14">详见文档</a>',options:[{title:"不可出现重复奖品",value:1},{title:"允许出现重复奖品",value:2}],newline:!0},{type:"blank",newline:!0},{title:"可切换房间数",key:"room_total",type:"number",tips:"最大30。 假如奖品库存允许创建1000个房间，一开始时并不会直接创建1000个房间。而是先创建此数量的房间，当其中一个房间抽完下架后自动创建一个新房间来保持这个可切换房间数。",default:10,required:!0,newline:!0},{title:"是否预售",key:"is_presell",type:"boolean",newline:!0},{title:"开售时间",key:"presell_date",type:"date",span:24,newline:!0,where:{is_presell:1}},{title:"预售期间允许购买",key:"presell_mode",type:"boolean",span:24,tips:"默认为关闭，即倒计时结束前仅可浏览信息，不可购买。",newline:!0,where:{is_presell:1}},{title:"是否包邮",key:"is_free_carriage",type:"boolean",tips:"不包邮将使用统一运费设置, 见“系统设置 -> 订单设置”",newline:!0},{title:"开盒提示",key:"tips",type:"input",newline:!0,span:18,placeholder:'不填则默认显示 "官方正品，非质量问题不支持退换"',tips:"显示在九宫格房间页 及 开盒页中"},{type:"blank",newline:!0},{title:"每人每日限制使用排除卡次数",key:"exclude_card_per_day",type:"number",newline:!0,span:12,tips:"不限制请填0"},{title:"每人每日限制使用透视卡次数",key:"show_card_per_day",type:"number",newline:!0,span:12,tips:"不限制请填0"},{title:"商品预览图",key:"detail_images",span:20,sizeLimit:400,type:"images",tips:"宽度1024以下，长图建议切成多张小图上传",required:!0,newline:!0},{type:"blank",newline:!0},{title:"开启邀请送次数",key:"is_invite_enabled",type:"boolean",newline:!0,tips:"开启后下方邀请规则才会生效"},{title:"邀请规则",key:"invite_rule",type:"invite_rule_input",newline:!0,tips:"邀请新用户注册为一次有效邀请，一次奖励为赠送一次抽奖机会",where:{}}]},frameUI:function(){return[{title:"房间背景图",key:"room_bg_image",type:"image",sizeLimit:200,isShowImageTips:!1,newline:!0,tips:"参考图片规格包中尺寸规范，不设置则使用装修模块的设置"},{title:"背景图色调",key:"bg_color_mode",type:"radio",newline:!0,default:1,options:[{title:"亮色调",value:1},{title:"暗色调",value:2}],span:12,tips:"默认为亮色调。选择暗色调后部分按钮字体会切换成白色"},{title:"大盒顶部图(扁平风)",key:"box_top_image",type:"image",required:!0,sizeLimit:300,isShowImageTips:!1,newline:!0,tips:"800*450 png （用于扁平风格时9宫格顶部的图片）"},{title:"小盒未售出时图片（扁平风）",key:"sku_thumb",type:"image",required:!0,sizeLimit:150,isShowImageTips:!1,newline:!0,tips:"200*200"},{title:"大箱子后挡板(3D版)",key:"big_box_bottom",type:"image",sizeLimit:300,isShowImageTips:!1,newline:!0,tips:"参考图片规格包中尺寸规范，不设置则使用装修模块的设置"},{title:"大箱子前挡板(3D版)",key:"big_box_top",type:"image",sizeLimit:300,isShowImageTips:!1,newline:!0,tips:"参考图片规格包中尺寸规范，不设置则使用装修模块的设置"},{title:"小盒子立体图(3D版)",key:"small_box_image",type:"image",sizeLimit:200,isShowImageTips:!1,newline:!0,tips:"参考图片规格包中尺寸规范，不设置则使用装修模块的设置"},{title:"开盒页3D立体盒子",key:"sku_3d_image",isShowImageTips:!1,sizeLimit:300,type:"image",span:24,newline:!0,tips:"600*900 png, 不传则使用默认"},{type:"blank",newline:!0},{title:"盒子展示风格",key:"theme_mode",type:"radio",newline:!0,default:1,options:[{title:"可切换 (3D优先)",value:1},{title:"可切换 (扁平风优先)",value:2},{title:"仅3D",value:3},{title:"仅扁平风",value:4}],span:24,tips:"默认展示3D版"},{title:"摇一摇次数",key:"free_tips_limit",type:"number",newline:!0,span:12,tips:"默认为2次，填0则隐藏摇一摇提示"},{title:"透视卡",key:"is_show_box",type:"boolean",newline:!0,span:6,default:1,tips:"是否显示"},{title:"排除卡",key:"is_exclude_box",type:"boolean",span:6,default:1,tips:"是否显示"},{title:"隐藏款榜单",key:"is_hidden_sku_rank",type:"boolean",span:6,default:0,tips:"是否显示"}]}},created:function(){},mounted:function(){var t=this;this.uuid=this.uuid||this.$route.params.uuid,this.$http.get("/ip/categories").then((function(e){t.categoryList=e.data.list})),this.$http.get("/image-tags").then((function(e){t.imageTagList=e.data.list})),this.initForm()},watch:{uuid:function(){this.initForm()}},methods:{initForm:function(){var t=this;this.uuid?this.$http("/".concat(H,"/").concat(this.uuid)).then((function(e){t.form=e.data.info})):this.form=q(q({},this.$initForm(this.frameBase)),this.$initForm(this.frameUI))},cancel:function(){this.$emit("cancel")},create:function(){var t=this;this.$http.post("/".concat(H),q({},this.form)).then((function(e){t.$message.success("创建成功"),t.$emit("success"),t.uuid="",t.form={}}))},update:function(){var t=this;this.$http.patch("/".concat(H,"/").concat(this.uuid),{type:"update",attributes:q(q({},this.form),{},{image_tag_id:this.form.image_tag_id||""})}).then((function(e){t.$message.success("更新成功"),t.$emit("success"),t.uuid="",t.form={}}))},submit:function(){this.uuid?this.update():this.create()}}},B=N,K=(i("92c8"),Object(_["a"])(B,I,T,!1,null,"0b912e01",null)),M=K.exports;function J(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,a)}return i}function W(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?J(Object(i),!0).forEach((function(e){Object(n["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):J(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var A="boxes",R="盲盒",G={components:{ISwitch:l["a"],EditForm:M,EditHiddenSku:v,EditNormalSku:C,EditCoverChip:z},props:{selectMode:{type:Boolean},params:{type:Object},size:{type:String,default:"default"}},data:function(){return{statusList:[{text:"上架中",key:"on_stock"},{text:"已下架",key:"off_stock"},{text:"已售罄",key:"sell_out"},{text:"标记的",key:"marked"}],actived:"on_stock",statusTotal:{on_stock:0,off_stock:0,sell_out:0,marked:0},isEdit:!1,editUuid:"",resourceTypeText:R,exportOptions:{status:"all",startTime:"",endTime:"",type:"normal"},list:[],page:1,per_page:10,total:0,key:"",keys:{status:"on_stock"},categoryList:[],category_id:void 0,isEditHiddenSku:!1,isEditNormalSku:!1,isEditCoverChip:!1}},watch:{params:function(){this.refreshData()},category_id:function(){this.refreshData()},keys:{handler:function(t){this.refreshData()},deep:!0}},computed:{pagination:function(){var t=this;return{defaultPageSize:this.per_page,defaultCurrent:this.page,total:this.total,onChange:function(e){t.page=e.current,t.per_page=e.pageSize,t.fetchData()}}}},filters:{},created:function(){this.fetchData(),this.fetchTotalData()},methods:{markBox:function(t){var e=this;this.$http.patch("/boxes/".concat(t.uuid),{type:"mark"}).then((function(t){e.$message.success("保存成功"),e.fetchData(),e.fetchTotalData()}))},handleEditCoverChip:function(t){this.editUuid=t.uuid,this.isEditCoverChip=!0},handleEditHiddenSku:function(t){this.editUuid=t.uuid,this.isEditHiddenSku=!0},handleEditNormalSku:function(t){this.editUuid=t.uuid,this.isEditNormalSku=!0},getPath:function(t){this.$getPathPopup.show({page:"/pages/boxDetail/index",param:"uuid="+t.uuid})},handleDelete:function(t){var e=this;this.$confirm({title:"提示",content:"确认删除吗？",onOk:function(){e.$http.delete("/".concat(A,"/").concat(t.uuid)).then((function(t){e.fetchData()}))}})},handleCopy:function(t){var e=this;this.$confirm({title:"确定复制吗",content:"将复制一个新活动到已下架状态栏",onOk:function(){e.$http.post("/".concat(A,"/").concat(t.uuid,"/copy")).then((function(t){e.$message.success("复制成功，请在“已下架”列表中编辑活动"),e.keys.status="off_stock",e.fetchData()}))}})},updateRewardAndBrokerage:function(t,e){var i=this;this.updateItem(t,e).then((function(t){i.$message.success("保存成功"),i.$iForm.hide(),i.fetchData()}))},updateItem:function(t,e){return this.$http.patch("/".concat(A,"/").concat(t.uuid),{type:"update",attributes:W({},e)})},statusChange:function(t,e){var i=this;this.updateItem(e,{status:t}).then((function(t){i.fetchData(),i.fetchTotalData()}))},listedStatusChange:function(t,e){var i=this;this.updateItem(e,{status:t}).then((function(t){i.fetchData(),i.fetchTotalData()}))},handleEditListWeight:function(t){var e=this;this.$globalForm.show({title:"编辑排序",items:[{type:"number",key:"list_weight",title:"排序",default:t.list_weight,required:!0}],success:function(i){e.updateItem(t,W({},i)).then((function(t){e.$message.success("保存成功"),e.$globalForm.hide(),e.fetchData()}))}})},handleCreate:function(){this.editUuid="",this.isEdit=!0},handleEdit:function(t){this.editUuid=t.uuid,this.isEdit=!0},refreshData:function(){this.page=1,this.key="",this.fetchData(),this.fetchTotalData()},onSearch:function(t){this.page=1,this.fetchData()},fetchTotalData:function(){var t=this;this.$http("/status-total/box").then((function(e){t.statusTotal=e.data.total}))},fetchData:function(){var t=this;this.isEdit=!1,this.$http.get("/".concat(A),{params:W(W({},this.params),{},{page:this.page,per_page:this.per_page,key:this.key,status:this.keys.status,category_id:this.category_id})}).then((function(e){t.list=e.data.list,t.total=e.data.item_total})).finally((function(){t.loading=!1}))},getCategoryList:function(){var t=this;this.$api.emit("category.list","article").then((function(e){t.categoryList=e.data.list}))}}},Q=G,V=(i("a445"),Object(_["a"])(Q,a,s,!1,null,"169ef0a7",null));e["default"]=V.exports},"691b":function(t,e,i){},"832d":function(t,e,i){"use strict";i("f442")},"92c8":function(t,e,i){"use strict";i("d35b")},a445:function(t,e,i){"use strict";i("1f7f")},aec1:function(t,e,i){},b0a5:function(t,e,i){"use strict";var a=i("b6c9");e["a"]=a["a"]},c685:function(t,e,i){"use strict";var a=function(){var t=this,e=t._self._c;return e("div",[1===t.info.sku_type?e("span",[t._v("-")]):2===t.info.sku_type?e("div",[t._v("\n    商城商品\n    "),t.info.product?e("div",[t._v("\n      【"+t._s(t.info.product.title)+"】\n    ")]):t._e()]):3===t.info.sku_type?e("span",[t._v("虚拟资产")]):t._e()])},s=[],n={name:"ISwitch",props:{info:{type:Object,default:function(){return{}}}},data:function(){return{}},watch:{},methods:{}},l=n,o=i("2877"),r=Object(o["a"])(l,a,s,!1,null,"c7676646",null);e["a"]=r.exports},d35b:function(t,e,i){},ddb1:function(t,e,i){"use strict";i("aec1")},f442:function(t,e,i){},fb01:function(t,e,i){"use strict";i("691b")}}]);