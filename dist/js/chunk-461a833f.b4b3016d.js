(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-461a833f"],{2612:function(t,e,a){"use strict";a.d(e,"a",(function(){return r})),a.d(e,"b",(function(){return o}));var n=a("b775"),i="/users";function r(t){return Object(n["b"])({url:i,method:"get",params:t})}function o(t,e){return Object(n["b"])({url:"".concat(i,"/").concat(e),method:"patch",data:{type:"update",attributes:t}})}},"55dd":function(t,e,a){"use strict";var n=a("5ca1"),i=a("d8e8"),r=a("4bf8"),o=a("79e5"),s=[].sort,c=[1,2,3];n(n.P+n.F*(o((function(){c.sort(void 0)}))||!o((function(){c.sort(null)}))||!a("2f21")(s)),"Array",{sort:function(t){return void 0===t?s.call(r(this)):s.call(r(this),i(t))}})},"86b7":function(t,e,a){"use strict";a("e258")},b0a5:function(t,e,a){"use strict";var n=a("b6c9");e["a"]=n["a"]},e258:function(t,e,a){},eb4c:function(t,e,a){},f722:function(t,e,a){"use strict";a("eb4c")},fa8d:function(t,e,a){"use strict";a.r(e);a("7f7f"),a("ac6a");var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"user-list"},[e("div",{staticClass:"content-head",staticStyle:{"margin-bottom":"20px"}},[e("div",{staticClass:"sort-keys"},[e("div",{staticClass:"tab-list"},t._l(t.statusList,(function(a,n){return e("div",{staticClass:"item",class:{actived:t.keys.type===a.key},on:{click:function(e){t.keys.type=a.key}}},[t._v("\n             "+t._s(a.text)+"\n             ("+t._s(t.statusTotal[a.key])+")\n           ")])})),0),e("a-input",{staticStyle:{width:"180px","margin-right":"10px"},attrs:{placeholder:"输入关键字",allowClear:""},on:{input:t.onSearch},model:{value:t.key,callback:function(e){t.key=e},expression:"key"}}),e("a-button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary"},on:{click:t.refresh}},[t._v("刷新")])],1),e("div",{staticStyle:{"margin-top":"4px"}},[e("a-button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary"},on:{click:function(e){t.isExport=!t.isExport}}},[t._v("导出Excel")])],1)]),e("a-table",{staticClass:"table",attrs:{rowKey:function(t){return t.uuid},dataSource:t.list,pagination:t.pagination},on:{change:t.onPaginationChange}},[e("a-table-column",{key:"id",attrs:{title:"ID",dataIndex:"id",width:"70px"}}),e("a-table-column",{key:"name",attrs:{title:"姓名",width:"230px"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"user"},[e("img",{staticClass:"headimg",attrs:{src:a.headimg,alt:"用户头像"}}),e("div",{staticClass:"right"},[e("div",{staticClass:"top"},[e("span",[t._v(t._s(a.name))]),"男"===a.gender?e("a-icon",{staticClass:"gender-man",attrs:{type:"man"}}):"女"===a.gender?e("a-icon",{staticClass:"gender-woman",attrs:{type:"woman"}}):t._e(),e("a",{staticStyle:{"margin-left":"10px"},attrs:{href:"javascript:;"},on:{click:function(e){return t.handleEdit(a)}}},[t._v("编辑")])],1),e("div",{staticClass:"bottom",staticStyle:{"margin-top":"4px"}},[e("span",{staticClass:"marked-tag",class:{actived:a.marked_at},on:{click:function(e){return t.markItem(a)}}},[t._v("标记")]),e("span",[t._v(t._s(a.phone))]),2===a.status?e("a-tag",{staticStyle:{"margin-left":"10px"},attrs:{color:"red"}},[t._v("已拉黑")]):t._e()],1)])])]}}])}),e("a-table-column",{attrs:{title:"邀请关系",width:"160px"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",[e("div",[t._v("\n              上级:\n              "),a.inviter?[e("img",{staticClass:"inviter-headimg",attrs:{src:a.inviter.headimg,alt:"用户头像"}}),t._v("\n                "+t._s(a.inviter.name)+"\n              ")]:[t._v("-")]],2),e("div",[t._v("直接粉丝: "+t._s(a.direct_invitees_count)+"人")]),e("div",[t._v("间接粉丝: "+t._s(a.indirect_invitees_count)+"人")])])]}}])}),e("a-table-column",{key:"level_score",attrs:{title:"成长值",dataIndex:"level_score",width:"80px"}}),e("a-table-column",{attrs:{title:"数据统计",width:"160px"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",[e("div",[t._v("拳击流水: "+t._s(a.pk_money))]),e("div",[t._v("无限赏流水: "+t._s(a.fudai_money))]),e("div",[t._v("无限赏盈亏: "+t._s(a.fudai_total))])])]}}])}),e("a-table-column",{key:"score",attrs:{title:"积分",dataIndex:"score",width:"70px"}}),e("a-table-column",{key:"redpack",attrs:{title:"红包",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",[t._v(t._s(a.redpack/100)+"元")])]}}])}),e("a-table-column",{key:"lucky_score",attrs:{title:"欧气值",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",[t._v(t._s(a.lucky_score))])]}}])}),e("a-table-column",{key:"created_at",attrs:{title:"注册日期",dataIndex:"created_at",width:"110px"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",[t._v(t._s(t._f("formatDate2")(a)))])]}}])}),e("a-table-column",{key:"last_active_at",attrs:{title:"最后活跃",dataIndex:"last_active_at",width:"100px"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",[t._v(t._s(t._f("formatDate")(a)))])]}}])}),e("a-table-column",{key:"action",attrs:{title:"操作",width:"200px"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",[e("div",[e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleAddScore(a)}}},[t._v("修改积分")]),e("a-divider",{attrs:{type:"vertical"}}),e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleAddRedpack(a)}}},[t._v("修改红包")])],1),e("div",{staticStyle:{"margin-top":"6px"}},[e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleGetPath(a)}}},[t._v("分销链接")]),e("a-divider",{attrs:{type:"vertical"}}),2!==a.status?e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleBlockUser(a)}}},[t._v("拉黑")]):e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleUnblockUser(a)}}},[t._v("取消拉黑")])],1)])]}}])})],1),e("ExportPopup",{attrs:{isShow:t.isExport},on:{hide:function(e){t.isExport=!1}}})],1)},i=[],r=(a("8e6e"),a("456d"),a("55dd"),a("ade3")),o=a("2612"),s=a("c1df"),c=a.n(s),u=function(){var t=this,e=t._self._c;return e("a-modal",{staticStyle:{top:"100px"},attrs:{title:"导出用户数据",visible:t.isShow,width:"600px",okText:"确认导出"},on:{ok:t.handleOk,cancel:t.handleCancel}},[e("IForm",{staticClass:"form-container",attrs:{formFrame:t.frame,formData:t.form},on:{"update:formData":function(e){t.form=e},"update:form-data":function(e){t.form=e}}}),t._v("\n  共查询到 "+t._s(t.itemTotal)+" 个用户\n")],1)},l=[],d=a("2f62"),p=(a("9fb0"),a("b0a5"));function f(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function h(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?f(Object(a),!0).forEach((function(e){Object(r["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):f(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var m={components:{IForm:p["a"]},props:{isShow:{type:Boolean}},computed:h(h({},Object(d["c"])(["baseUrl"])),{},{uploadUrl:function(){return"".concat(this.baseUrl,"/admin-api/batch-deliver")},frame:function(){return[{type:"number",key:"per_page",title:"每页条数",default:2e3},{type:"number",key:"page",title:"要导出的页码",tips:"填5则导出第5页",default:1}]}}),data:function(){return{form:{abc:"abc"},itemTotal:0}},watch:{form:{handler:function(t,e){var a=this;this.$http.post("/export/user-total",this.form).then((function(t){a.itemTotal=t.data.total}))},deep:!0}},mounted:function(){var t=this;this.$http.post("/export/user-total",this.form).then((function(e){t.itemTotal=e.data.total}))},methods:{handleChange:function(t){t.file,t.fileList},handleOk:function(){this.$http.post("/export/users",h({},this.form)).then((function(t){var e=window.open();e.location=Object({NODE_ENV:"production",BASE_URL:"/"}).VUE_APP_BASE_URL+"".concat(t.data.url)})).finally((function(){}))},handleCancel:function(){this.$emit("hide")}}},y=m,v=(a("f722"),a("2877")),k=Object(v["a"])(y,u,l,!1,null,"04886e49",null),b=k.exports;function _(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function g(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?_(Object(a),!0).forEach((function(e){Object(r["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):_(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var x={name:"UserList",components:{ExportPopup:b},data:function(){return{statusList:[{text:"微信",key:"wechat"},{text:"快手",key:"kuaishou"},{text:"支付宝",key:"alipay"},{text:"App",key:"app"},{text:"标记的",key:"marked"},{text:"拉黑的",key:"blocked"}],keys:{type:"wechat"},statusTotal:{wechat:0,byte_dance:0,marked:0,blocked:0,alipay:0},loading:!1,list:[],page:1,per_page:10,total:0,key:"",sort:"time",form:this.$form.createForm(this),visible:!1,confirmLoading:!1,timeout:null,isExport:!1}},computed:{pagination:function(){return{defaultPageSize:this.per_page,defaultCurrent:this.page,total:this.total,showTotal:function(t){return"共 ".concat(t," 条")}}}},filters:{formatDate:function(t){return t?c()(t).fromNow():""},formatDate2:function(t){return t?c()(t).format("YYYY-MM-DD"):""}},created:function(){this.fetchData(),this.fetchTotalData()},watch:{sort:function(t){this.fetchData()},keys:{handler:function(t){this.refresh()},deep:!0}},methods:{handleGetPath:function(t){this.$getPathPopup.show({page:"/pages/index/index",param:"inviter="+t.uuid})},handleBlockUser:function(t){var e=this;this.$confirm({title:"确认要拉黑用户吗",content:"拉黑后用户能正常浏览页面，但不能进行需要登录的操作，如下单、加购物车，同时不结算佣金。",onOk:function(){e.$http.patch("/users/".concat(t.uuid),{type:"block"}).then((function(t){e.fetchData(),e.fetchTotalData()}))}})},handleUnblockUser:function(t){var e=this;this.$confirm({title:"提示",content:"确认要取消拉黑用户吗？",onOk:function(){e.$http.patch("/users/".concat(t.uuid),{type:"unblock"}).then((function(t){e.fetchData(),e.fetchTotalData()}))}})},markItem:function(t){var e=this;this.$http.patch("/users/".concat(t.uuid),{type:"mark"}).then((function(t){e.$message.success("保存成功"),e.fetchData(),e.fetchTotalData()}))},onPaginationChange:function(t){this.page=t.current,this.per_page=t.pageSize,this.fetchData()},refresh:function(){this.page=1,this.key="",this.fetchData(),this.fetchTotalData()},onSearch:function(t){var e=this;this.page=1,clearTimeout(this.timeout),this.timeout=setTimeout((function(){e.fetchData()}),300)},handleAddScore:function(t){var e=this;this.$iForm.show({title:"修改用户积分",frame:[{type:"radio",key:"type",options:[{title:"增加",value:"in"},{title:"减少",value:"out"}],title:"变动类型",required:!0},{type:"number",key:"score",title:"变动数量",required:!0},{type:"textarea",key:"description",title:"变动原因",tips:"变动原因会显示在用户的积分流水记录中",required:!0}],success:function(a){e.$http({url:"/users/".concat(t.uuid,"/score"),method:"PATCH",data:g({type:"add"},a)}).then((function(t){e.$message.success("操作成功"),e.$iForm.hide(),e.fetchData()}))}})},handleAddRedpack:function(t){var e=this;this.$iForm.show({title:"修改用户积分",frame:[{type:"radio",key:"type",options:[{title:"增加",value:"in"},{title:"减少",value:"out"}],title:"变动类型",required:!0},{type:"price",key:"redpack",title:"变动金额",required:!0},{type:"textarea",key:"description",title:"变动原因",tips:"变动原因会显示在用户的红包流水记录中",required:!0}],success:function(a){e.$http({url:"/users/".concat(t.uuid,"/redpack"),method:"PATCH",data:g({type:"add"},a)}).then((function(t){e.$message.success("操作成功"),e.$iForm.hide(),e.fetchData()}))}})},handleEdit:function(t){var e=this;this.$iForm.show({title:"修改用户信息",frame:[{type:"input",key:"name",title:"用户名",default:t.name,required:!0},{type:"input",key:"phone",title:"手机号",default:t.phone},{type:"input",key:"city",title:"地区",default:t.city},{type:"textarea",key:"remark",title:"备注",default:t.remark}],success:function(a){e.$http({url:"/users/".concat(t.uuid),method:"PATCH",data:{type:"update",attributes:a}}).then((function(t){e.$message.success("更新成功"),e.$iForm.hide(),e.fetchData()}))}})},handleOk:function(){var t=this;this.form.validateFields((function(e,a){e||(t.confirmLoading=!0,Object(o["b"])(a,t.current.uuid).then((function(e){t.visible=!1,t.fetchData()})).finally((function(){t.confirmLoading=!1})))}))},fetchTotalData:function(){var t=this;this.$http("/status-total/user").then((function(e){t.statusTotal=e.data.total}))},fetchData:function(){var t=this;this.loading=!0,Object(o["a"])({page:this.page,per_page:this.per_page,key:this.key,sort:this.sort,type:this.keys.type}).then((function(e){t.list=e.data.list,t.total=e.data.item_total})).finally((function(){t.loading=!1}))}}},w=x,O=(a("86b7"),Object(v["a"])(w,n,i,!1,null,"3cd56a75",null));e["default"]=O.exports}}]);