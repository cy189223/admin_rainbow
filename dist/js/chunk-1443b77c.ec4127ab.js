(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1443b77c"],{8001:function(t,e,a){},b8c4:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"content-wrap"},[e("div",{staticClass:"header-action",staticStyle:{"margin-bottom":"20px"}},[e("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:t.handlePlus}},[t._v("添加"+t._s(t.title))]),t.tips?e("span",{staticStyle:{"margin-left":"10px"}},[t._v(t._s(t.tips))]):t._e(),e("span",{staticStyle:{"flex-grow":"1"}}),e("a-input-search",{staticStyle:{width:"200px"},attrs:{placeholder:"输入关键字"},on:{search:t.onSearch}})],1),e("a-table",{staticClass:"table",attrs:{rowKey:function(t){return t.uuid},dataSource:t.list,pagination:t.pagination},on:{change:t.currentChange},scopedSlots:t._u([{key:"expandedRowRender",fn:function(a){return t.subCategory?e("a-table",{staticClass:"expanded-table",attrs:{rowKey:function(t){return t.uuid},dataSource:a.sub_categories,pagination:!1}},[e("a-table-column",{key:"childTitle",attrs:{title:"子分类",dataIndex:"title"}}),e("a-table-column",{key:"thumb",attrs:{title:"图片"},scopedSlots:t._u([{key:"default",fn:function(t){return[e("img",{staticClass:"thumb",attrs:{src:t.thumb,alt:""}})]}}],null,!0)}),e("a-table-column",{key:"childAction",attrs:{title:"操作"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",[e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleEdit(i,a.id)}}},[t._v("编辑")]),e("a-divider",{attrs:{type:"vertical"}}),e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleDlete(i,a.id)}}},[t._v("删除")])],1)]}}],null,!0)})],1):t._e()}}],null,!0)},[e("a-table-column",{key:"title",attrs:{title:"分类标题",dataIndex:"title"}}),t.isShowThumb?e("a-table-column",{key:"thumb",attrs:{title:"图片"},scopedSlots:t._u([{key:"default",fn:function(t){return[e("img",{staticClass:"thumb",attrs:{src:t.thumb,alt:""}})]}}],null,!1,1577562979)}):t._e(),t.subCategory?e("a-table-column",{key:"children",attrs:{title:"子分类"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",[t._v(t._s(a.sub_categories.length))])]}}],null,!1,2868594589)}):t._e(),e("a-table-column",{key:"list_weight",attrs:{title:"权重"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",[t._v(t._s(a.list_weight))]),e("span",{staticStyle:{"margin-left":"10px"},on:{click:function(e){return t.handleEditListWeight(a)}}},[e("a",{attrs:{href:"javascript:;"}},[e("a-icon",{attrs:{type:"edit"}})],1)])]}}])}),e("a-table-column",{attrs:{title:"显示/隐藏"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("ISwitch",{attrs:{value:a.is_listed,active:1,unactive:0},on:{change:function(e){return t.listedStatusChange(e,a)}}})]}}])}),e("a-table-column",{key:"action",attrs:{title:"操作"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",[e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleEdit(a)}}},[t._v("编辑")]),e("a-divider",{attrs:{type:"vertical"}}),e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.handleDlete(a)}}},[t._v("删除")])],1)]}}])})],1),e("a-modal",{staticStyle:{top:"100px"},attrs:{title:t.actionTitle,visible:t.visible,width:"600px"},on:{ok:t.handleOk,cancel:t.handleCancel}},[e("a-form",{attrs:{form:t.form}},[e("a-form-item",{attrs:{label:"标题","label-col":{span:5},"wrapper-col":{span:12}}},[e("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["title",{rules:[{required:!0,message:"请输入标题"}]}],expression:"[\n            'title',\n            {rules: [{ required: true, message: '请输入标题' }]}\n          ]"}],attrs:{placeholder:"请输入"}})],1),t.isShowThumb?e("a-form-item",{attrs:{label:"封面图","label-col":{span:5}}},[e("upload-images",{attrs:{tips:"建议尺寸 400*400",size:"small"},model:{value:t.thumb,callback:function(e){t.thumb=e},expression:"thumb"}})],1):t._e(),t.subCategory?e("a-form-item",{attrs:{label:"父分类","label-col":{span:5},"wrapper-col":{span:12}}},[e("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["parent_id"],expression:"[\n            'parent_id'\n          ]"}],attrs:{placeholder:"空时为一级分类",allowClear:""}},t._l(t.list,(function(a){return e("a-select-option",{key:a.id,attrs:{value:a.id}},[t._v("\n            "+t._s(a.title)+"\n          ")])})),1)],1):t._e()],1)],1)],1)},n=[],r=(a("8e6e"),a("ac6a"),a("456d"),a("ade3")),s=a("7971"),l=a("7cc6");function o(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function c(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?o(Object(a),!0).forEach((function(e){Object(r["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var u={name:"Category",props:{type:{type:String},title:{type:String,default:function(){return"分类"}},tips:{type:String,default:function(){return""}},isShowThumb:{type:Boolean},subCategory:{type:Boolean,default:function(){return!1}}},components:{UploadImages:s["a"],ISwitch:l["a"]},data:function(){return{loading:!1,list:[],page:1,per_page:10,total:0,thumb:"",visible:!1,form:this.$form.createForm(this),current:{},actionType:0}},watch:{type:function(){this.page=1,this.fetch()}},computed:{pagination:function(){return{defaultPageSize:this.per_page,defaultCurrent:this.page,total:this.total}},actionTitle:function(){return(0===this.actionType?"创建":"编辑")+this.title}},created:function(){this.fetch()},methods:{isShowProductMiniappStatusChange:function(t,e){this.updateCategory(e.uuid,{is_show_product_miniapp:t})},listedStatusChange:function(t,e){this.updateCategory(e.uuid,{is_listed:t})},currentChange:function(t){console.log(t),this.page=t.current,this.fetch()},onSearch:function(t){console.log(t)},handleDlete:function(t){var e=this;this.$confirm({title:"提示",content:"确认删除分类 “".concat(t.title,"” ？"),onOk:function(){e.$http.delete("/".concat(e.type,"/categories/").concat(t.uuid)).then((function(t){e.fetch()}))}})},handleEditListWeight:function(t){var e=this;this.$globalForm.show({title:"编辑排序",items:[{type:"number",key:"list_weight",title:"排序",default:t.list_weight,required:!0}],success:function(a){e.updateCategory(t.uuid,a).then((function(t){e.$message.success("保存成功"),e.$globalForm.hide()}))}})},handleEdit:function(t,e){var a=this;this.visible=!0,this.actionType=1,this.current=t,this.$nextTick((function(){a.form.setFields({title:{value:t.title},parent_id:{value:e||""},sub_title:{value:t.sub_title||""}}),a.thumb=t.thumb}))},handleOk:function(){var t=this;this.form.validateFields((function(e,a){if(!e){var i={title:a.title,parent_id:a.parent_id,sub_title:a.sub_title,thumb:t.thumb};0===t.actionType?t.$http.post("/".concat(t.type,"/categories"),c({},i)).then((function(e){t.visible=!1,t.fetch()})):t.updateCategory(t.current.uuid,i)}}))},updateCategory:function(t,e){var a=this;return this.$http.put("/".concat(this.type,"/categories/").concat(t),{type:"update",attributes:e}).then((function(t){a.visible=!1,a.fetch()}))},handleCancel:function(){this.visible=!1},handlePlus:function(){this.visible=!0,this.actionType=0,this.thumb="",this.form.resetFields()},fetch:function(){var t=this;this.$http.get("/".concat(this.type,"/categories"),{params:{page:this.page,per_page:this.per_page}}).then((function(e){t.list=e.data.list,t.total=e.data.item_total}))}}},p=u,h=(a("d0e8"),a("2877")),d=Object(h["a"])(p,i,n,!1,null,"7ec3f7c9",null);e["default"]=d.exports},d0e8:function(t,e,a){"use strict";a("8001")}}]);